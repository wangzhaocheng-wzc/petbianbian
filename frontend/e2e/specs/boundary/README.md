# 边界条件测试套件

## 概述

边界条件测试套件专门用于测试应用程序在各种边界条件和极端输入下的行为。这些测试确保应用程序能够正确处理异常输入，防止安全漏洞，并提供良好的用户体验。

## 测试范围

### 1. 输入验证边界测试 (`input-validation-boundary.spec.ts`)

这个测试套件专注于验证应用程序对各种边界输入的处理能力，确保输入验证机制的健壮性和安全性。

#### 字符串长度边界测试
- **用户名长度测试**
  - 空字符串验证
  - 最小长度边界（2个字符）
  - 最大长度边界（50个字符）
  - 超长字符串处理

- **宠物名称长度测试**
  - 空名称验证
  - 最大长度限制（30个字符）
  - 超长名称处理

#### 特殊字符输入测试
- **XSS攻击防护**
  - Script标签注入
  - 事件处理器注入
  - HTML标签注入
  - JavaScript伪协议

- **HTML注入防护**
  - 恶意HTML标签
  - 内联事件处理器
  - 危险属性注入

#### 数值边界测试
- **宠物年龄边界**
  - 负数验证
  - 零值处理
  - 最小有效值（1岁）
  - 最大有效值（50岁）

- **宠物体重边界**
  - 负数验证
  - 零值处理
  - 小数值处理
  - 最大重量限制（200公斤）

#### 文件上传边界测试
- **文件大小限制**
  - 空文件处理
  - 超大文件拒绝（>10MB）
  - 边界大小测试

- **文件类型验证**
  - 支持的图片格式（JPG, PNG, GIF）
  - 不支持的文件类型拒绝
  - MIME类型验证

- **文件名安全性**
  - 路径遍历攻击防护
  - 特殊字符处理
  - 超长文件名处理

#### SQL注入防护测试
- **登录表单注入**
  - 经典SQL注入载荷
  - 联合查询注入
  - 布尔盲注测试

- **搜索功能注入**
  - 搜索参数注入
  - 数据篡改防护
  - 查询结果验证

#### 输入长度极限测试
- **超长文本处理**
  - 10000字符内容测试
  - 内容长度限制验证
  - 截断处理验证

- **Unicode字符测试**
  - 多语言字符支持
  - Emoji字符处理
  - 特殊Unicode字符

### 2. 数据边界测试 (`data-boundary.spec.ts`)

这个测试套件专注于测试应用程序在处理大量数据、数据库连接和缓存管理方面的边界条件。

#### 大数据量处理测试
- **分页功能测试**
  - 大量宠物数据分页显示
  - 分页控件功能验证
  - 分页性能测试

- **分析记录处理**
  - 大量分析记录的分页和筛选
  - 记录列表性能测试
  - 数据加载优化验证

- **社区帖子加载**
  - 无限滚动加载测试
  - 大量帖子数据处理
  - 加载性能监控

#### 数据库连接池和事务边界测试
- **并发数据库操作**
  - 多用户同时数据库操作
  - 连接池管理测试
  - 事务完整性验证

- **长时间事务处理**
  - 长时间分析过程测试
  - 事务超时处理
  - 数据一致性保证

- **连接超时处理**
  - 网络延迟模拟
  - 连接超时恢复
  - 错误处理机制

#### 缓存溢出和内存管理测试
- **图片缓存测试**
  - 大量图片上传缓存处理
  - 内存使用监控
  - 缓存清理机制

- **数据缓存一致性**
  - 跨页面数据一致性
  - 缓存更新机制
  - 数据同步验证

- **会话缓存管理**
  - 会话过期处理
  - 本地存储限制测试
  - 存储容量管理

### 3. 并发和竞态条件测试 (`concurrency-race-conditions.spec.ts`)

这个测试套件专注于测试应用程序在多用户并发操作和竞态条件下的行为。

#### 多用户同时操作测试
- **并发注册和登录**
  - 多用户同时注册测试
  - 并发登录验证
  - 用户会话管理

- **并发数据操作**
  - 多用户同时创建宠物
  - 并发分析操作
  - 数据创建一致性

#### 资源锁定和死锁检测测试
- **数据编辑冲突**
  - 同一数据并发编辑
  - 冲突检测机制
  - 乐观锁实现

- **文件上传竞争**
  - 并发文件上传测试
  - 资源竞争处理
  - 上传队列管理

- **数据库连接池测试**
  - 连接池耗尽测试
  - 死锁检测和恢复
  - 资源释放机制

#### 数据一致性和事务隔离测试
- **并发修改一致性**
  - 多页面数据一致性
  - 实时数据同步
  - 冲突解决机制

- **事务回滚测试**
  - 事务失败回滚
  - 数据完整性保证
  - 错误恢复机制

- **读写隔离测试**
  - 读写操作隔离
  - 事务隔离级别
  - 数据可见性控制

## 安全测试重点

### 1. 注入攻击防护
- **SQL注入**: 验证所有数据库查询都使用参数化查询
- **XSS攻击**: 确保用户输入被正确转义和清理
- **命令注入**: 防止系统命令执行
- **路径遍历**: 阻止文件系统访问攻击

### 2. 输入验证
- **长度限制**: 所有输入字段都有适当的长度限制
- **格式验证**: 邮箱、电话号码等格式验证
- **类型检查**: 数值、日期等类型验证
- **字符集限制**: 允许的字符范围验证

### 3. 文件上传安全
- **文件类型**: 只允许安全的文件类型
- **文件大小**: 防止大文件攻击
- **文件名**: 清理危险的文件名
- **内容检查**: 验证文件内容与扩展名匹配

## 运行测试

### 单独运行边界测试
```bash
# 运行所有边界条件测试
node frontend/e2e/run-boundary-tests.cjs

# 运行特定的边界测试
npx playwright test specs/boundary/input-validation-boundary.spec.ts
npx playwright test specs/boundary/data-boundary.spec.ts
npx playwright test specs/boundary/concurrency-race-conditions.spec.ts
```

### 在CI/CD中运行
```bash
# 作为完整测试套件的一部分
npm run test:e2e:boundary
```

## 测试数据

### 测试载荷示例

#### XSS载荷
```javascript
const xssPayloads = [
  '<script>alert("XSS")</script>',
  '<img src=x onerror=alert(1)>',
  '<svg onload=alert(1)>',
  'javascript:alert(1)'
];
```

#### SQL注入载荷
```javascript
const sqlPayloads = [
  "' OR '1'='1",
  "'; DROP TABLE users; --",
  "' UNION SELECT * FROM users --"
];
```

#### 文件名攻击载荷
```javascript
const maliciousNames = [
  '../../../etc/passwd',
  '<script>alert(1)</script>.jpg',
  'very-long-filename-that-exceeds-limits.jpg'
];
```

## 预期结果

### 成功标准
1. **输入验证**: 所有无效输入都被正确拒绝并显示适当错误消息
2. **安全防护**: 所有注入攻击都被阻止，没有恶意代码执行
3. **边界处理**: 边界值被正确处理，不会导致应用崩溃
4. **用户体验**: 错误消息清晰友好，帮助用户理解问题

### 失败指标
1. **安全漏洞**: 任何注入攻击成功执行
2. **应用崩溃**: 边界输入导致应用程序崩溃
3. **数据泄露**: 错误消息暴露敏感信息
4. **绕过验证**: 恶意输入绕过验证机制

## 维护指南

### 定期更新
1. **新攻击载荷**: 定期更新测试载荷以应对新的攻击方式
2. **边界调整**: 根据业务需求调整边界值
3. **安全补丁**: 跟进安全更新并相应调整测试

### 扩展测试
1. **新功能**: 为新功能添加相应的边界测试
2. **新输入字段**: 为新的输入字段添加验证测试
3. **新文件类型**: 为支持的新文件类型添加测试

## 故障排除

### 常见问题
1. **测试超时**: 增加等待时间或优化测试逻辑
2. **元素未找到**: 检查页面元素选择器是否正确
3. **验证失败**: 确认应用程序的验证逻辑是否正确实现

### 调试技巧
1. **截图**: 在失败时自动截图以便调试
2. **日志**: 记录详细的测试执行日志
3. **步骤分解**: 将复杂测试分解为更小的步骤

## 相关文档
- [安全测试指南](../security/README.md)
- [输入验证规范](../../docs/input-validation.md)
- [文件上传安全](../../docs/file-upload-security.md)