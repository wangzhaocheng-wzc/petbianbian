import{a as e,j as t,u as a,F as s}from"./index-379b094b.js";import{r}from"./react-vendor-7927b0b6.js";import{a as l}from"./api-f70ec57c.js";import{C as i,a as d,L as n,B as c,p as m,c as o,d as h,A as x,g as p,f as g}from"./index-797d9c28.js";import{i as u,v as N,a5 as b,b as y,a6 as f,g as v,a7 as w,l as j,y as k,a8 as C,S,a9 as A,r as _,m as P,T as $,U as M}from"./ui-vendor-f43192ea.js";import"./router-2b5ad94b.js";import"./utils-2ce30174.js";const R=new class{async createReport(e){return(await l.post("/moderation/reports",e)).data}async preModerate(e){return(await l.post("/moderation/pre-moderate",e)).data}async getPendingContent(e=1,t=20){return(await l.get(`/moderation/pending?page=${e}&limit=${t}`)).data.data}async moderateDecision(e){return(await l.post("/moderation/decision",e)).data}async batchModerate(e){return(await l.post("/moderation/batch",{items:e})).data}async getReports(e={}){const t=new URLSearchParams;Object.entries(e).forEach(([e,a])=>{void 0!==a&&t.append(e,a.toString())});return(await l.get(`/moderation/reports?${t}`)).data.data}async getUserViolationStats(e){return(await l.get(`/moderation/users/${e}/violations`)).data.data}async getModerationStats(){return(await l.get("/moderation/stats")).data.data}};i.register(d,n,c,m,o,h,x);const T=({stats:a})=>{if(!a)return e("div",{children:"加载中..."});const s={labels:["帖子","评论","举报"],datasets:[{data:[a.pending.posts,a.pending.comments,a.pending.reports],backgroundColor:["#3B82F6","#10B981","#F59E0B"],borderWidth:1}]},r={labels:["拒绝的帖子","拒绝的评论","已处理举报"],datasets:[{label:"已处理内容",data:[a.processed.rejectedPosts,a.processed.rejectedComments,a.processed.resolvedReports],backgroundColor:"#EF4444",borderWidth:1}]},l={labels:["帖子","评论","举报"],datasets:[{label:"近期活动",data:[a.recentActivity.posts,a.recentActivity.comments,a.recentActivity.reports],backgroundColor:"#8B5CF6",borderWidth:1}]};return t("div",{className:"space-y-6",children:[t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{className:"bg-white p-6 rounded-lg border",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"待审核内容分布"}),e("div",{className:"h-80",children:e(p,{data:s,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed}`}}}}}})})]}),t("div",{className:"bg-white p-6 rounded-lg border",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"已处理内容统计"}),e("div",{className:"h-80",children:e(g,{data:r,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]})]}),t("div",{className:"bg-white p-6 rounded-lg border",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"近7天审核活动"}),e("div",{className:"h-80",children:e(g,{data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e("h4",{className:"text-lg font-medium text-blue-900 mb-2",children:"待审核"}),t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-blue-700",children:"帖子:"}),e("span",{className:"font-medium text-blue-900",children:a.pending.posts})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-blue-700",children:"评论:"}),e("span",{className:"font-medium text-blue-900",children:a.pending.comments})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-blue-700",children:"举报:"}),e("span",{className:"font-medium text-blue-900",children:a.pending.reports})]}),e("div",{className:"border-t border-blue-200 pt-2 mt-2",children:t("div",{className:"flex justify-between",children:[e("span",{className:"text-blue-700 font-medium",children:"总计:"}),e("span",{className:"font-bold text-blue-900",children:a.pending.total})]})})]})]}),t("div",{className:"bg-red-50 p-6 rounded-lg",children:[e("h4",{className:"text-lg font-medium text-red-900 mb-2",children:"已处理"}),t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-red-700",children:"拒绝帖子:"}),e("span",{className:"font-medium text-red-900",children:a.processed.rejectedPosts})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-red-700",children:"拒绝评论:"}),e("span",{className:"font-medium text-red-900",children:a.processed.rejectedComments})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-red-700",children:"处理举报:"}),e("span",{className:"font-medium text-red-900",children:a.processed.resolvedReports})]}),e("div",{className:"border-t border-red-200 pt-2 mt-2",children:t("div",{className:"flex justify-between",children:[e("span",{className:"text-red-700 font-medium",children:"总计:"}),e("span",{className:"font-bold text-red-900",children:a.processed.total})]})})]})]}),t("div",{className:"bg-purple-50 p-6 rounded-lg",children:[e("h4",{className:"text-lg font-medium text-purple-900 mb-2",children:"近期活动"}),t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-purple-700",children:"帖子审核:"}),e("span",{className:"font-medium text-purple-900",children:a.recentActivity.posts})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-purple-700",children:"评论审核:"}),e("span",{className:"font-medium text-purple-900",children:a.recentActivity.comments})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-purple-700",children:"举报处理:"}),e("span",{className:"font-medium text-purple-900",children:a.recentActivity.reports})]}),e("div",{className:"border-t border-purple-200 pt-2 mt-2",children:t("div",{className:"flex justify-between",children:[e("span",{className:"text-purple-700 font-medium",children:"总计:"}),e("span",{className:"font-bold text-purple-900",children:a.recentActivity.total})]})})]})]})]})]})},U=({onUpdate:a})=>{const[s,l]=r.useState(null),[i,d]=r.useState(!0),[n,c]=r.useState(new Set),[m,o]=r.useState(!1);r.useEffect(()=>{h()},[]);const h=async()=>{try{d(!0);const e=await R.getPendingContent();l(e)}catch(e){}finally{d(!1)}},x=async(e,t,s,r)=>{try{o(!0),await R.moderateDecision({type:e,id:t,decision:s,notes:r}),await h(),a()}catch(l){}finally{o(!1)}},p=async e=>{if(0!==n.size)try{o(!0);const t=Array.from(n).map(t=>{const[a,s]=t.split(":");return{type:a,id:s,decision:e}});await R.batchModerate(t),c(new Set),await h(),a()}catch(t){}finally{o(!1)}},g=(e,t)=>{const a=`${e}:${t}`,s=new Set(n);s.has(a)?s.delete(a):s.add(a),c(s)},j=e=>new Date(e).toLocaleString("zh-CN");if(i)return e("div",{className:"flex justify-center items-center h-64",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})});if(!s)return e("div",{children:"加载失败"});const k=s.posts.length+s.comments.length;return t("div",{className:"space-y-6",children:[n.size>0&&e("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t("div",{className:"flex items-center justify-between",children:[t("span",{className:"text-blue-800",children:["已选择 ",n.size," 项内容"]}),t("div",{className:"space-x-2",children:[t("button",{onClick:()=>p("approve"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-1"}),"批量通过"]}),t("button",{onClick:()=>p("reject"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e(N,{className:"h-4 w-4 mr-1"}),"批量拒绝"]})]})]})}),t("div",0===k?{className:"text-center py-12",children:[e(u,{className:"mx-auto h-12 w-12 text-green-400"}),e("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"没有待审核内容"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"所有内容都已审核完毕"})]}:{className:"space-y-4",children:[s.posts.length>0&&t("div",{children:[t("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e(b,{className:"h-5 w-5 mr-2"}),"待审核帖子 (",s.posts.length,")"]}),e("div",{className:"space-y-4",children:s.posts.map(a=>{var s,r,l;return e("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:t("div",{className:"flex items-start justify-between",children:[t("div",{className:"flex items-start space-x-3 flex-1",children:[e("input",{type:"checkbox",checked:n.has(`post:${a._id}`),onChange:()=>g("post",a._id),className:"mt-1 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),t("div",{className:"flex-1",children:[t("div",{className:"flex items-center space-x-2 mb-2",children:[e(y,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:(null==(s=a.userId)?void 0:s.username)||"未知用户"}),e(f,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-500",children:j(a.createdAt)})]}),e("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:a.title}),e("p",{className:"text-gray-700 mb-3 line-clamp-3",children:a.content}),a.images&&a.images.length>0&&t("div",{className:"flex space-x-2 mb-3",children:[a.images.slice(0,3).map((t,a)=>e("img",{src:t,alt:"",className:"h-16 w-16 object-cover rounded"},a)),a.images.length>3&&t("div",{className:"h-16 w-16 bg-gray-100 rounded flex items-center justify-center text-sm text-gray-500",children:["+",a.images.length-3]})]}),t("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[t("span",{className:"flex items-center",children:[e(v,{className:"h-4 w-4 mr-1"}),(null==(r=a.interactions)?void 0:r.views)||0]}),t("span",{className:"flex items-center",children:[e(w,{className:"h-4 w-4 mr-1"}),(null==(l=a.comments)?void 0:l.length)||0]}),e("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs",children:a.category})]})]})]}),t("div",{className:"flex space-x-2 ml-4",children:[t("button",{onClick:()=>x("post",a._id,"approve"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-1"}),"通过"]}),t("button",{onClick:()=>x("post",a._id,"reject"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e(N,{className:"h-4 w-4 mr-1"}),"拒绝"]})]})]})},a._id)})})]}),s.comments.length>0&&t("div",{children:[t("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e(w,{className:"h-5 w-5 mr-2"}),"待审核评论 (",s.comments.length,")"]}),e("div",{className:"space-y-4",children:s.comments.map(a=>{var s;return e("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:t("div",{className:"flex items-start justify-between",children:[t("div",{className:"flex items-start space-x-3 flex-1",children:[e("input",{type:"checkbox",checked:n.has(`comment:${a._id}`),onChange:()=>g("comment",a._id),className:"mt-1 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded"}),t("div",{className:"flex-1",children:[t("div",{className:"flex items-center space-x-2 mb-2",children:[e(y,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:(null==(s=a.userId)?void 0:s.username)||"未知用户"}),e(f,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-500",children:j(a.createdAt)})]}),e("p",{className:"text-gray-700 mb-2",children:a.content}),a.postId&&t("div",{className:"text-sm text-gray-500",children:["回复帖子: ",a.postId.title||"未知帖子"]})]})]}),t("div",{className:"flex space-x-2 ml-4",children:[t("button",{onClick:()=>x("comment",a._id,"approve"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-1"}),"通过"]}),t("button",{onClick:()=>x("comment",a._id,"reject"),disabled:m,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e(N,{className:"h-4 w-4 mr-1"}),"拒绝"]})]})]})},a._id)})})]})]})]})},E=({onUpdate:a})=>{const[s,l]=r.useState([]),[i,d]=r.useState(!0),[n,c]=r.useState(!1),[m,o]=r.useState({status:"pending",targetType:"",page:1,limit:20}),[h,x]=r.useState({page:1,limit:20,total:0,totalPages:0});r.useEffect(()=>{p()},[m]);const p=async()=>{try{d(!0);const e=await R.getReports(m);l(e.reports||[]),x(e.pagination||{page:1,limit:20,total:0,totalPages:0})}catch(e){}finally{d(!1)}},g=async(e,t,s)=>{try{c(!0),await R.moderateDecision({type:"report",id:e,decision:"resolve"===t?"approve":"reject",notes:s}),await p(),a()}catch(r){}finally{c(!1)}},k=e=>({pending:"待处理",reviewed:"已审核",resolved:"已解决",dismissed:"已驳回"}[e]||e),C=t=>{switch(t){case"post":return e(b,{className:"h-4 w-4"});case"comment":return e(w,{className:"h-4 w-4"});case"user":return e(y,{className:"h-4 w-4"});default:return e(j,{className:"h-4 w-4"})}},S=e=>new Date(e).toLocaleString("zh-CN");return i?e("div",{className:"flex justify-center items-center h-64",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):t("div",{className:"space-y-6",children:[e("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"状态"}),t("select",{value:m.status,onChange:e=>o({...m,status:e.target.value,page:1}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e("option",{value:"",children:"全部状态"}),e("option",{value:"pending",children:"待处理"}),e("option",{value:"reviewed",children:"已审核"}),e("option",{value:"resolved",children:"已解决"}),e("option",{value:"dismissed",children:"已驳回"})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"举报类型"}),t("select",{value:m.targetType,onChange:e=>o({...m,targetType:e.target.value,page:1}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e("option",{value:"",children:"全部类型"}),e("option",{value:"post",children:"帖子"}),e("option",{value:"comment",children:"评论"}),e("option",{value:"user",children:"用户"})]})]}),e("div",{className:"flex items-end",children:e("button",{onClick:()=>o({status:"pending",targetType:"",page:1,limit:20}),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"重置筛选"})})]})}),0===s.length?t("div",{className:"text-center py-12",children:[e(j,{className:"mx-auto h-12 w-12 text-gray-400"}),e("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"没有找到举报"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"当前筛选条件下没有举报记录"})]}):e("div",{className:"space-y-4",children:s.map(a=>{var s,r,l,i;return e("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:t("div",{className:"flex items-start justify-between",children:[t("div",{className:"flex-1",children:[t("div",{className:"flex items-center space-x-4 mb-4",children:[t("div",{className:"flex items-center space-x-2",children:[C(a.targetType),t("span",{className:"text-sm font-medium text-gray-900",children:[(i=a.targetType,{post:"帖子",comment:"评论",user:"用户"}[i]||i),"举报"]})]}),e("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l=a.status,{pending:"bg-yellow-100 text-yellow-800",reviewed:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",dismissed:"bg-gray-100 text-gray-800"}[l]||"bg-gray-100 text-gray-800"}`,children:k(a.status)}),e("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium",children:(r=a.reason,{spam:"垃圾信息",inappropriate:"不当内容",harassment:"骚扰行为",misinformation:"虚假信息",other:"其他"}[r]||r)})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[t("div",{children:[t("div",{className:"flex items-center space-x-2 mb-2",children:[e(y,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"举报人:"}),e("span",{className:"text-sm font-medium text-gray-900",children:(null==(s=a.reporterId)?void 0:s.username)||"未知用户"})]}),t("div",{className:"flex items-center space-x-2",children:[e(f,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"举报时间:"}),e("span",{className:"text-sm text-gray-900",children:S(a.createdAt)})]})]}),a.reviewerId&&t("div",{children:[t("div",{className:"flex items-center space-x-2 mb-2",children:[e(v,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"处理人:"}),e("span",{className:"text-sm font-medium text-gray-900",children:a.reviewerId.username})]}),t("div",{className:"flex items-center space-x-2",children:[e(f,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"处理时间:"}),e("span",{className:"text-sm text-gray-900",children:S(a.updatedAt)})]})]})]}),a.description&&t("div",{className:"mb-4",children:[e("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"举报描述:"}),e("p",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded-md",children:a.description})]}),a.targetContent&&t("div",{className:"mb-4",children:[e("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"被举报内容:"}),t("div",{className:"bg-gray-50 p-3 rounded-md",children:["post"===a.targetType&&t("div",{children:[e("h5",{className:"font-medium text-gray-900 mb-1",children:a.targetContent.title}),e("p",{className:"text-sm text-gray-700 line-clamp-3",children:a.targetContent.content})]}),"comment"===a.targetType&&e("p",{className:"text-sm text-gray-700",children:a.targetContent.content}),"user"===a.targetType&&t("div",{className:"flex items-center space-x-2",children:[e(y,{className:"h-4 w-4 text-gray-400"}),t("span",{className:"text-sm text-gray-700",children:["用户: ",a.targetContent.username]})]})]})]}),a.reviewNotes&&t("div",{className:"mb-4",children:[e("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"处理备注:"}),e("p",{className:"text-sm text-gray-700 bg-blue-50 p-3 rounded-md",children:a.reviewNotes})]})]}),"pending"===a.status&&t("div",{className:"flex space-x-2 ml-4",children:[t("button",{onClick:()=>g(a._id,"resolve"),disabled:n,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-1"}),"解决"]}),t("button",{onClick:()=>g(a._id,"dismiss"),disabled:n,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700 disabled:opacity-50",children:[e(N,{className:"h-4 w-4 mr-1"}),"驳回"]})]})]})},a._id)})}),h.totalPages>1&&t("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-gray-700",children:["显示第 ",(h.page-1)*h.limit+1," - ",Math.min(h.page*h.limit,h.total)," 条， 共 ",h.total," 条记录"]}),t("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>o({...m,page:Math.max(1,h.page-1)}),disabled:h.page<=1,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),t("span",{className:"px-3 py-1 text-sm text-gray-700",children:["第 ",h.page," / ",h.totalPages," 页"]}),e("button",{onClick:()=>o({...m,page:Math.min(h.totalPages,h.page+1)}),disabled:h.page>=h.totalPages,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]})]})]})},L=()=>{const[a,s]=r.useState([]),[i,d]=r.useState(!0),[n,c]=r.useState(!1),[m,o]=r.useState(null),[h,x]=r.useState(null),[p,g]=r.useState(!1),[f,w]=r.useState({search:"",role:"",status:"",page:1,limit:20}),[j,$]=r.useState({page:1,limit:20,total:0,totalPages:0});r.useEffect(()=>{M()},[f]);const M=async()=>{try{d(!0);const e=new URLSearchParams;Object.entries(f).forEach(([t,a])=>{void 0!==a&&""!==a&&e.append(t,a.toString())});const t=(await l.get(`/admin/users?${e}`)).data.data;s(t.users||[]),$(t.pagination||{page:1,limit:20,total:0,totalPages:0})}catch(e){}finally{d(!1)}},T=async(e,t)=>{try{if(c(!0),await l.post(`/admin/users/${e}/${t}`),await M(),m&&m._id===e){const t=a.find(t=>t._id===e);t&&o(t)}}catch(s){}finally{c(!1)}},U=e=>({admin:"bg-red-100 text-red-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),E=e=>({admin:"管理员",moderator:"版主",user:"用户"}[e]||e),L=e=>new Date(e).toLocaleString("zh-CN"),V=(e,t)=>e?t?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",z=(e,t)=>e?t?"已验证":"未验证":"已禁用";return i?e("div",{className:"flex justify-center items-center h-64",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):t("div",{className:"space-y-6",children:[e("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:t("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t("div",{className:"md:col-span-2",children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"搜索用户"}),t("div",{className:"relative",children:[e(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e("input",{type:"text",value:f.search,onChange:e=>w({...f,search:e.target.value,page:1}),placeholder:"搜索用户名或邮箱...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"角色"}),t("select",{value:f.role,onChange:e=>w({...f,role:e.target.value,page:1}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e("option",{value:"",children:"全部角色"}),e("option",{value:"user",children:"用户"}),e("option",{value:"moderator",children:"版主"}),e("option",{value:"admin",children:"管理员"})]})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"状态"}),t("select",{value:f.status,onChange:e=>w({...f,status:e.target.value,page:1}),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e("option",{value:"",children:"全部状态"}),e("option",{value:"active",children:"活跃"}),e("option",{value:"inactive",children:"禁用"}),e("option",{value:"verified",children:"已验证"}),e("option",{value:"unverified",children:"未验证"})]})]})]})}),0===a.length?t("div",{className:"text-center py-12",children:[e(y,{className:"mx-auto h-12 w-12 text-gray-400"}),e("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"没有找到用户"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"当前筛选条件下没有用户记录"})]}):e("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"角色"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"统计"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注册时间"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"最后登录"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(a=>t("tr",{className:"hover:bg-gray-50",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10",children:a.avatar?e("img",{className:"h-10 w-10 rounded-full object-cover",src:a.avatar,alt:""}):e("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e(y,{className:"h-6 w-6 text-gray-600"})})}),t("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900",children:a.username}),e("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${U(a.role)}`,children:E(a.role)})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${V(a.isActive,a.isVerified)}`,children:z(a.isActive,a.isVerified)})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t("div",{className:"space-y-1",children:[t("div",{className:"flex items-center space-x-2",children:[e(b,{className:"h-3 w-3 text-gray-400"}),t("span",{children:[a.stats.totalPosts," 帖子"]})]}),t("div",{className:"flex items-center space-x-2",children:[e(v,{className:"h-3 w-3 text-gray-400"}),t("span",{children:[a.stats.totalAnalysis," 分析"]})]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:L(a.createdAt)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.lastLoginAt?L(a.lastLoginAt):"从未登录"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t("div",{className:"flex items-center justify-end space-x-2",children:[e("button",{onClick:()=>(async e=>{o(e);try{const t=await R.getUserViolationStats(e._id);x(t)}catch(t){x(null)}g(!0)})(a),className:"text-orange-600 hover:text-orange-900",children:e(v,{className:"h-4 w-4"})}),a.isActive?e("button",{onClick:()=>T(a._id,"deactivate"),disabled:n,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e(C,{className:"h-4 w-4"})}):e("button",{onClick:()=>T(a._id,"activate"),disabled:n,className:"text-green-600 hover:text-green-900 disabled:opacity-50",children:e(u,{className:"h-4 w-4"})}),"user"===a.role&&e("button",{onClick:()=>T(a._id,"promote"),disabled:n,className:"text-blue-600 hover:text-blue-900 disabled:opacity-50",children:e(S,{className:"h-4 w-4"})})]})})]},a._id))})]})})}),j.totalPages>1&&t("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-gray-700",children:["显示第 ",(j.page-1)*j.limit+1," - ",Math.min(j.page*j.limit,j.total)," 条， 共 ",j.total," 条记录"]}),t("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>w({...f,page:Math.max(1,j.page-1)}),disabled:j.page<=1,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),t("span",{className:"px-3 py-1 text-sm text-gray-700",children:["第 ",j.page," / ",j.totalPages," 页"]}),e("button",{onClick:()=>w({...f,page:Math.min(j.totalPages,j.page+1)}),disabled:j.page>=j.totalPages,className:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]})]}),p&&m&&e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[t("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"用户详情"}),e("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e(N,{className:"h-6 w-6"})})]}),t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center space-x-4",children:[e("div",{className:"flex-shrink-0",children:m.avatar?e("img",{className:"h-16 w-16 rounded-full object-cover",src:m.avatar,alt:""}):e("div",{className:"h-16 w-16 rounded-full bg-gray-300 flex items-center justify-center",children:e(y,{className:"h-8 w-8 text-gray-600"})})}),t("div",{children:[e("h4",{className:"text-xl font-medium text-gray-900",children:m.username}),e("p",{className:"text-gray-600",children:m.email}),t("div",{className:"flex items-center space-x-2 mt-2",children:[e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${U(m.role)}`,children:E(m.role)}),e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${V(m.isActive,m.isVerified)}`,children:z(m.isActive,m.isVerified)})]})]})]}),t("div",{children:[e("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"个人资料"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.profile.firstName&&t("div",{className:"flex items-center space-x-2",children:[e(y,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"姓名:"}),t("span",{className:"text-sm text-gray-900",children:[m.profile.firstName," ",m.profile.lastName]})]}),m.profile.phone&&t("div",{className:"flex items-center space-x-2",children:[e(A,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"电话:"}),e("span",{className:"text-sm text-gray-900",children:m.profile.phone})]}),m.profile.location&&t("div",{className:"flex items-center space-x-2",children:[e(_,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"位置:"}),e("span",{className:"text-sm text-gray-900",children:m.profile.location})]}),t("div",{className:"flex items-center space-x-2",children:[e(P,{className:"h-4 w-4 text-gray-400"}),e("span",{className:"text-sm text-gray-600",children:"注册时间:"}),e("span",{className:"text-sm text-gray-900",children:L(m.createdAt)})]})]}),m.profile.bio&&t("div",{className:"mt-3",children:[e("span",{className:"text-sm text-gray-600",children:"个人简介:"}),e("p",{className:"text-sm text-gray-900 mt-1 bg-gray-50 p-2 rounded",children:m.profile.bio})]})]}),t("div",{children:[e("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"活动统计"}),t("div",{className:"grid grid-cols-3 gap-4",children:[t("div",{className:"text-center",children:[e("div",{className:"text-2xl font-bold text-blue-600",children:m.stats.totalPosts}),e("div",{className:"text-sm text-gray-600",children:"发布帖子"})]}),t("div",{className:"text-center",children:[e("div",{className:"text-2xl font-bold text-green-600",children:m.stats.totalAnalysis}),e("div",{className:"text-sm text-gray-600",children:"健康分析"})]}),t("div",{className:"text-center",children:[e("div",{className:"text-2xl font-bold text-purple-600",children:m.stats.reputation}),e("div",{className:"text-sm text-gray-600",children:"声誉值"})]})]})]}),h&&t("div",{children:[e("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"违规记录"}),t("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t("div",{className:"text-center",children:[e("div",{className:"text-xl font-bold text-red-600",children:h.rejectedPosts}),e("div",{className:"text-sm text-gray-600",children:"被拒帖子"})]}),t("div",{className:"text-center",children:[e("div",{className:"text-xl font-bold text-red-600",children:h.rejectedComments}),e("div",{className:"text-sm text-gray-600",children:"被拒评论"})]}),t("div",{className:"text-center",children:[e("div",{className:"text-xl font-bold text-yellow-600",children:h.reports}),e("div",{className:"text-sm text-gray-600",children:"被举报次数"})]}),t("div",{className:"text-center",children:[e("div",{className:"text-xl font-bold text-gray-600",children:h.totalViolations}),e("div",{className:"text-sm text-gray-600",children:"总违规次数"})]})]})]}),t("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[m.isActive?t("button",{onClick:()=>T(m._id,"deactivate"),disabled:n,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e(C,{className:"h-4 w-4 mr-2"}),"禁用用户"]}):t("button",{onClick:()=>T(m._id,"activate"),disabled:n,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-2"}),"激活用户"]}),!m.isVerified&&t("button",{onClick:()=>T(m._id,"verify"),disabled:n,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:[e(u,{className:"h-4 w-4 mr-2"}),"验证用户"]}),"user"===m.role&&t("button",{onClick:()=>T(m._id,"promote"),disabled:n,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 disabled:opacity-50",children:[e(S,{className:"h-4 w-4 mr-2"}),"提升为版主"]})]})]})]})})]})},V=()=>{const{user:l}=a(),[i,d]=r.useState("dashboard"),[n,c]=r.useState(null),[m,o]=r.useState(!0);r.useEffect(()=>{h()},[]);const h=async()=>{try{o(!0);const e=await R.getModerationStats();c(e)}catch(e){}finally{o(!1)}};if(!l||"admin"!==l.role)return e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center",children:[e(S,{className:"mx-auto h-12 w-12 text-gray-400"}),e("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"权限不足"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"您没有访问管理后台的权限"})]})});const x=[{id:"dashboard",name:"概览",icon:$},{id:"pending",name:"待审核",icon:v,badge:null==n?void 0:n.pending.total},{id:"reports",name:"举报管理",icon:j,badge:null==n?void 0:n.pending.reports},{id:"users",name:"用户管理",icon:M}];return t("div",{className:"min-h-screen bg-gray-50",children:[e("div",{className:"bg-white shadow",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t("div",{className:"flex justify-between items-center py-6",children:[t("div",{className:"flex items-center",children:[e(S,{className:"h-8 w-8 text-orange-600"}),e("h1",{className:"ml-3 text-2xl font-bold text-gray-900",children:"管理后台"})]}),t("div",{className:"text-sm text-gray-500",children:["欢迎，",l.username]})]})})}),t("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n&&t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{className:"p-5",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0",children:e(v,{className:"h-6 w-6 text-blue-600"})}),e("div",{className:"ml-5 w-0 flex-1",children:t("dl",{children:[e("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"待审核内容"}),e("dd",{className:"text-lg font-medium text-gray-900",children:n.pending.total})]})})]})})}),e("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{className:"p-5",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0",children:e(j,{className:"h-6 w-6 text-yellow-600"})}),e("div",{className:"ml-5 w-0 flex-1",children:t("dl",{children:[e("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"待处理举报"}),e("dd",{className:"text-lg font-medium text-gray-900",children:n.pending.reports})]})})]})})}),e("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{className:"p-5",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0",children:e(u,{className:"h-6 w-6 text-green-600"})}),e("div",{className:"ml-5 w-0 flex-1",children:t("dl",{children:[e("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"已处理内容"}),e("dd",{className:"text-lg font-medium text-gray-900",children:n.processed.total})]})})]})})}),e("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{className:"p-5",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0",children:e($,{className:"h-6 w-6 text-purple-600"})}),e("div",{className:"ml-5 w-0 flex-1",children:t("dl",{children:[e("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"近7天活动"}),e("dd",{className:"text-lg font-medium text-gray-900",children:n.recentActivity.total})]})})]})})})]}),t("div",{className:"bg-white shadow rounded-lg mb-6",children:[e("div",{className:"border-b border-gray-200",children:e("nav",{className:"-mb-px flex space-x-8 px-6",children:x.map(a=>{const s=a.icon;return t("button",{onClick:()=>d(a.id),className:(i===a.id?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center",children:[e(s,{className:"h-5 w-5 mr-2"}),a.name,a.badge&&a.badge>0&&e("span",{className:"ml-2 bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:a.badge})]},a.id)})})}),e("div",{className:"p-6",children:m?e("div",{className:"flex justify-center items-center h-64",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):t(s,{children:["dashboard"===i&&e(T,{stats:n}),"pending"===i&&e(U,{onUpdate:h}),"reports"===i&&e(E,{onUpdate:h}),"users"===i&&e(L,{})]})})]})]})]})};export{V as default};
