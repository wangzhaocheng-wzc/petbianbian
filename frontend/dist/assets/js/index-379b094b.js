var e=Object.defineProperty,t=(t,r,s)=>(((t,r,s)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s})(t,"symbol"!=typeof r?r+"":r,s),s);import{r,a as s,b as n}from"./react-vendor-7927b0b6.js";import{u as a,L as o,N as i,R as l,a as c,B as d}from"./router-2b5ad94b.js";import{a as m}from"./utils-2ce30174.js";import{L as u,X as h,M as f,H as p,C as g,a as y,B as v,T as x,U as w,b,S as E,D as N,W as _,c as T,R as k}from"./ui-vendor-f43192ea.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var P={exports:{}},S={},L=r,I=Symbol.for("react.element"),R=Symbol.for("react.fragment"),A=Object.prototype.hasOwnProperty,O=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,j={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var s,n={},a=null,o=null;for(s in void 0!==r&&(a=""+r),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)A.call(t,s)&&!j.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:I,type:e,key:a,ref:o,props:n,_owner:O.current}}S.Fragment=R,S.jsx=C,S.jsxs=C,P.exports=S;var z=P.exports;const D=z.Fragment,q=z.jsx,Q=z.jsxs;var M={},B=s;M.createRoot=B.createRoot,M.hydrateRoot=B.hydrateRoot;const V={},$=function(e,t,r){if(!t||0===t.length)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in V)return;V[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(!!r)for(let r=s.length-1;r>=0;r--){const n=s[r];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})},W=r.createContext(void 0);function F({children:e}){const[t,s]=r.useState(null),[n,a]=r.useState(!0),o=!!t;r.useEffect(()=>{const e=()=>{s(null)};return window.addEventListener("auth-logout",e),(async()=>{if(localStorage.getItem("accessToken"))try{const e=await m.get("/auth/me");s(e.data.data.user)}catch(e){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),s(null)}a(!1)})(),()=>{window.removeEventListener("auth-logout",e)}},[]);const i=()=>{s(null),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/"},l={user:t,isLoading:n,isAuthenticated:o,login:async e=>{var t,r,n,o;try{a(!0);const t=(await m.post("/auth/login",e)).data;if(t.success&&t.data){const{user:e,tokens:r}=t.data;s(e),localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken)}return t}catch(i){return{success:!1,message:(null==(r=null==(t=i.response)?void 0:t.data)?void 0:r.message)||"登录失败",errors:null==(o=null==(n=i.response)?void 0:n.data)?void 0:o.errors}}finally{a(!1)}},register:async e=>{var t,r,n,o;try{a(!0);const t=(await m.post("/auth/register",e)).data;if(t.success&&t.data){const{user:e,tokens:r}=t.data;s(e),localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken)}return t}catch(i){return{success:!1,message:(null==(r=null==(t=i.response)?void 0:t.data)?void 0:r.message)||"注册失败",errors:null==(o=null==(n=i.response)?void 0:n.data)?void 0:o.errors}}finally{a(!1)}},logout:i,refreshToken:async()=>{try{const e=localStorage.getItem("refreshToken");if(!e)return!1;const t=await m.post("/auth/refresh",{refreshToken:e}),{accessToken:r}=t.data.data.tokens;return localStorage.setItem("accessToken",r),!0}catch(e){return i(),!1}}};return q(W.Provider,{value:l,children:e})}function U(){const e=r.useContext(W);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}function H({children:e}){const t=a(),{user:s,isAuthenticated:n,logout:i}=U(),[l,c]=r.useState(!1),d=[{name:"首页",href:"/",icon:p,requireAuth:!1},{name:"便便分析",href:"/analysis",icon:g,requireAuth:!0},{name:"我的宠物",href:"/pets",icon:y,requireAuth:!0},{name:"健康记录",href:"/records",icon:v,requireAuth:!0},{name:"数据统计",href:"/statistics",icon:x,requireAuth:!0},{name:"宠物社区",href:"/community",icon:w,requireAuth:!1},{name:"个人中心",href:"/profile",icon:b,requireAuth:!0},{name:"管理后台",href:"/admin",icon:E,requireAuth:!0,requireRole:"admin"}].filter(e=>!e.requireAuth||!!n&&(!e.requireRole||(null==s?void 0:s.role)===e.requireRole)),m=()=>{i(),c(!1)};return Q("div",{className:"min-h-screen bg-gray-50",children:[q("nav",{className:"bg-white shadow-sm border-b",children:Q("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[Q("div",{className:"flex justify-between h-16",children:[q("div",{className:"flex items-center",children:q(o,{to:"/",className:"text-xl font-bold text-primary-600",children:"🐾 宠物健康助手"})}),Q("div",{className:"hidden md:flex md:items-center md:space-x-8",children:[d.map(e=>{const r=e.icon,s=t.pathname===e.href;return Q(o,{to:e.href,className:"inline-flex items-center px-1 pt-1 text-sm font-medium "+(s?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"),children:[q(r,{className:"w-4 h-4 mr-2"}),e.name]},e.name)}),Q("div",n?{className:"flex items-center space-x-4",children:[Q("span",{className:"text-sm text-gray-700",children:["欢迎，",null==s?void 0:s.username]}),Q("button",{onClick:m,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-gray-500 hover:text-gray-700",children:[q(u,{className:"w-4 h-4 mr-2"}),"退出"]})]}:{className:"flex items-center space-x-4",children:[q(o,{to:"/login",className:"text-gray-500 hover:text-gray-700 px-3 py-2 text-sm font-medium",children:"登录"}),q(o,{to:"/register",className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"注册"})]})]}),q("div",{className:"md:hidden flex items-center",children:q("button",{onClick:()=>c(!l),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100",children:q(l?h:f,{className:"block h-6 w-6"})})})]}),l&&Q("div",{className:"md:hidden",children:[q("div",{className:"pt-2 pb-3 space-y-1",children:d.map(e=>{const r=e.icon,s=t.pathname===e.href;return q(o,{to:e.href,onClick:()=>c(!1),className:"block pl-3 pr-4 py-2 text-base font-medium "+(s?"text-primary-600 bg-primary-50 border-r-4 border-primary-600":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:Q("div",{className:"flex items-center",children:[q(r,{className:"w-5 h-5 mr-3"}),e.name]})},e.name)})}),q("div",{className:"pt-4 pb-3 border-t border-gray-200",children:Q("div",n?{className:"space-y-1",children:[Q("div",{className:"px-4 py-2",children:[q("div",{className:"text-base font-medium text-gray-800",children:null==s?void 0:s.username}),q("div",{className:"text-sm text-gray-500",children:null==s?void 0:s.email})]}),q("button",{onClick:m,className:"block w-full text-left px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50",children:Q("div",{className:"flex items-center",children:[q(u,{className:"w-5 h-5 mr-3"}),"退出登录"]})})]}:{className:"space-y-1",children:[q(o,{to:"/login",onClick:()=>c(!1),className:"block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50",children:"登录"}),q(o,{to:"/register",onClick:()=>c(!1),className:"block px-4 py-2 text-base font-medium text-primary-600 hover:text-primary-700 hover:bg-primary-50",children:"注册"})]})})]})]})}),q("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:e})]})}function K({children:e,requireAuth:t=!0,redirectTo:r="/login"}){var s,n;const{isAuthenticated:o,isLoading:l}=U(),c=a();if(l)return q("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:Q("div",{className:"text-center",children:[q("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto"}),q("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})});if(t&&!o)return q(i,{to:r,state:{from:c},replace:!0});if(!t&&o){const e=(null==(n=null==(s=c.state)?void 0:s.from)?void 0:n.pathname)||"/";return q(i,{to:e,replace:!0})}return q(D,{children:e})}m.defaults.baseURL="http://localhost:5000/api",m.interceptors.request.use(e=>{const t=localStorage.getItem("accessToken");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),m.interceptors.response.use(e=>e,async e=>{var t,r;const s=e.config;if(null==(t=s.url)?void 0:t.includes("/auth/refresh"))return Promise.reject(e);if(401===(null==(r=e.response)?void 0:r.status)&&!s._retry){s._retry=!0;const t=localStorage.getItem("refreshToken");if(t)try{const e=await m.post("/auth/refresh",{refreshToken:t}),{accessToken:r}=e.data.data.tokens;return localStorage.setItem("accessToken",r),s.headers.Authorization=`Bearer ${r}`,m(s)}catch(n){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.dispatchEvent(new Event("auth-logout")),Promise.reject(e)}else localStorage.removeItem("accessToken"),window.dispatchEvent(new Event("auth-logout"))}return Promise.reject(e)});const G=({size:e="md",className:t="",text:r="加载中..."})=>Q("div",{className:`flex flex-col items-center justify-center p-8 ${t}`,children:[q("div",{className:`${{sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"}[e]} border-4 border-gray-200 border-t-orange-500 rounded-full animate-spin`,role:"status","aria-label":"Loading"}),r&&q("p",{className:"mt-4 text-sm text-gray-600 animate-pulse",children:r})]}),J=()=>{const[e,t]=r.useState(null),[s,n]=r.useState(!1),[a,o]=r.useState(!1);r.useEffect(()=>{(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=!0===window.navigator.standalone,r=window.matchMedia("(display-mode: standalone)").matches;o(e||t||r)})();const e=e=>{e.preventDefault(),t(e);const r=localStorage.getItem("pwa-install-declined"),s=r?parseInt(r):0,a=Date.now();(!r||a-s>6048e5)&&n(!0)},r=()=>{o(!0),n(!1),t(null),localStorage.removeItem("pwa-install-declined")};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",r),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",r)}},[]);const i=()=>{n(!1),localStorage.setItem("pwa-install-declined",Date.now().toString())};return!a&&s&&e?q("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm bg-white border border-gray-200 rounded-lg shadow-lg p-4 z-50",children:Q("div",{className:"flex items-start space-x-3",children:[q("div",{className:"flex-shrink-0",children:q("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:q(N,{className:"w-5 h-5 text-orange-600"})})}),Q("div",{className:"flex-1 min-w-0",children:[q("h3",{className:"text-sm font-medium text-gray-900",children:"安装应用到桌面"}),q("p",{className:"text-sm text-gray-500 mt-1",children:"将宠物健康平台添加到主屏幕，获得更好的使用体验"}),Q("div",{className:"flex space-x-2 mt-3",children:[q("button",{onClick:async()=>{if(e)try{await e.prompt();const{outcome:r}=await e.userChoice;"accepted"===r||localStorage.setItem("pwa-install-declined",Date.now().toString()),t(null),n(!1)}catch(r){}},className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:"安装"}),q("button",{onClick:i,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:"稍后"})]})]}),q("button",{onClick:i,className:"flex-shrink-0 text-gray-400 hover:text-gray-500",children:q(h,{className:"w-4 h-4"})})]})}):null},Y=()=>{const[e,t]=r.useState(navigator.onLine),[s,n]=r.useState(!1);return r.useEffect(()=>{const e=()=>{t(!0),n(!1)},r=()=>{t(!1),n(!0)};return window.addEventListener("online",e),window.addEventListener("offline",r),navigator.onLine||n(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}},[]),r.useEffect(()=>{if(e&&s){const e=setTimeout(()=>{n(!1)},3e3);return()=>clearTimeout(e)}},[e,s]),!s&&e?null:q("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 "+(s?"translate-y-0 opacity-100":"-translate-y-full opacity-0"),children:q("div",{className:"flex items-center space-x-2 px-4 py-2 rounded-lg shadow-lg "+(e?"bg-green-500 text-white":"bg-red-500 text-white"),children:Q(D,e?{children:[q(_,{className:"w-4 h-4"}),q("span",{className:"text-sm font-medium",children:"网络已连接"})]}:{children:[q(T,{className:"w-4 h-4"}),q("span",{className:"text-sm font-medium",children:"网络已断开，正在离线模式下运行"})]})})})},X=()=>{const[e,t]=r.useState(!1),[s,n]=r.useState(null);r.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(e=>{n(e),e.addEventListener("updatefound",()=>{const r=e.installing;r&&r.addEventListener("statechange",()=>{"installed"===r.state&&navigator.serviceWorker.controller&&t(!0)})})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))},[]);const a=()=>{t(!1)};return e?q("div",{className:"fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-4 z-50",children:Q("div",{className:"flex items-start space-x-3",children:[q("div",{className:"flex-shrink-0",children:q("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:q(k,{className:"w-5 h-5 text-blue-600"})})}),Q("div",{className:"flex-1 min-w-0",children:[q("h3",{className:"text-sm font-medium text-gray-900",children:"应用更新可用"}),q("p",{className:"text-sm text-gray-500 mt-1",children:"发现新版本，点击更新以获得最新功能和改进"}),Q("div",{className:"flex space-x-2 mt-3",children:[q("button",{onClick:()=>{s&&s.waiting&&s.waiting.postMessage({type:"SKIP_WAITING"}),t(!1)},className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"立即更新"}),q("button",{onClick:a,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"稍后"})]})]}),q("button",{onClick:a,className:"flex-shrink-0 text-gray-400 hover:text-gray-500",children:q(h,{className:"w-4 h-4"})})]})}):null},Z=r.lazy(()=>$(()=>import("./Home-4f4eed25.js"),["assets/js/Home-4f4eed25.js","assets/js/router-2b5ad94b.js","assets/js/react-vendor-7927b0b6.js","assets/js/ui-vendor-f43192ea.js","assets/js/utils-2ce30174.js"])),ee=r.lazy(()=>$(()=>import("./Login-52fa5983.js"),["assets/js/Login-52fa5983.js","assets/js/react-vendor-7927b0b6.js","assets/js/index.esm-04d114ed.js","assets/js/router-2b5ad94b.js","assets/js/ui-vendor-f43192ea.js","assets/js/utils-2ce30174.js"])),te=r.lazy(()=>$(()=>import("./Register-a323690f.js"),["assets/js/Register-a323690f.js","assets/js/react-vendor-7927b0b6.js","assets/js/index.esm-04d114ed.js","assets/js/router-2b5ad94b.js","assets/js/ui-vendor-f43192ea.js","assets/js/utils-2ce30174.js"])),re=r.lazy(()=>$(()=>import("./PoopAnalysis-9db4183b.js"),["assets/js/PoopAnalysis-9db4183b.js","assets/js/react-vendor-7927b0b6.js","assets/js/ui-vendor-f43192ea.js","assets/js/usePets-2d4c1e5f.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/router-2b5ad94b.js"])),se=r.lazy(()=>$(()=>import("./Records-47e52ec3.js"),["assets/js/Records-47e52ec3.js","assets/js/react-vendor-7927b0b6.js","assets/js/ui-vendor-f43192ea.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/router-2b5ad94b.js"])),ne=r.lazy(()=>$(()=>import("./Community-5f2075ba.js"),["assets/js/Community-5f2075ba.js","assets/js/react-vendor-7927b0b6.js","assets/js/ui-vendor-f43192ea.js","assets/js/utils-2ce30174.js","assets/js/usePets-2d4c1e5f.js","assets/js/api-f70ec57c.js","assets/js/router-2b5ad94b.js"])),ae=r.lazy(()=>$(()=>import("./Profile-6b7dd4d1.js"),["assets/js/Profile-6b7dd4d1.js","assets/js/react-vendor-7927b0b6.js","assets/js/usePets-2d4c1e5f.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/ui-vendor-f43192ea.js","assets/js/router-2b5ad94b.js"])),oe=r.lazy(()=>$(()=>import("./Pets-8e618e89.js"),["assets/js/Pets-8e618e89.js","assets/js/react-vendor-7927b0b6.js","assets/js/usePets-2d4c1e5f.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/ui-vendor-f43192ea.js","assets/js/router-2b5ad94b.js"])),ie=r.lazy(()=>$(()=>import("./Statistics-d0ce24f8.js"),["assets/js/Statistics-d0ce24f8.js","assets/js/react-vendor-7927b0b6.js","assets/js/index-797d9c28.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/ui-vendor-f43192ea.js","assets/js/usePets-2d4c1e5f.js","assets/js/router-2b5ad94b.js"])),le=r.lazy(()=>$(()=>import("./Debug-b29dcc94.js"),["assets/js/Debug-b29dcc94.js","assets/js/react-vendor-7927b0b6.js","assets/js/router-2b5ad94b.js","assets/js/utils-2ce30174.js","assets/js/ui-vendor-f43192ea.js"])),ce=r.lazy(()=>$(()=>import("./Admin-b3745e6a.js"),["assets/js/Admin-b3745e6a.js","assets/js/react-vendor-7927b0b6.js","assets/js/api-f70ec57c.js","assets/js/utils-2ce30174.js","assets/js/index-797d9c28.js","assets/js/ui-vendor-f43192ea.js","assets/js/router-2b5ad94b.js"]));function de(){return Q(F,{children:[q(H,{children:q(r.Suspense,{fallback:q(G,{}),children:Q(l,{children:[q(c,{path:"/",element:q(Z,{})}),q(c,{path:"/login",element:q(ee,{})}),q(c,{path:"/register",element:q(te,{})}),q(c,{path:"/debug",element:q(le,{})}),q(c,{path:"/analysis",element:q(K,{children:q(re,{})})}),q(c,{path:"/records",element:q(K,{children:q(se,{})})}),q(c,{path:"/pets",element:q(K,{children:q(oe,{})})}),q(c,{path:"/statistics",element:q(K,{children:q(ie,{})})}),q(c,{path:"/community",element:q(ne,{})}),q(c,{path:"/profile",element:q(K,{children:q(ae,{})})}),q(c,{path:"/admin",element:q(K,{children:q(ce,{})})})]})})}),q(Y,{}),q(J,{}),q(X,{})]})}const me=()=>{if(!window.performance)return{};const e=performance.getEntriesByType("navigation")[0],t=performance.getEntriesByType("paint"),r={pageLoadTime:e.loadEventEnd-e.fetchStart,domContentLoadedTime:e.domContentLoadedEventEnd-e.fetchStart};return t.forEach(e=>{"first-contentful-paint"===e.name&&(r.firstContentfulPaint=e.startTime)}),r},ue=()=>{if(!window.performance)return[];return performance.getEntriesByType("resource").map(e=>({name:e.name,duration:e.responseEnd-e.requestStart,size:e.transferSize||0}))};const he=new class{constructor(){t(this,"metrics",{}),t(this,"observers",[]),this.initializeMonitoring()}initializeMonitoring(){"complete"===document.readyState?this.collectBasicMetrics():window.addEventListener("load",()=>{this.collectBasicMetrics()}),this.observeWebVitals()}collectBasicMetrics(){this.metrics={...this.metrics,...me(),resourceLoadTimes:ue()}}observeWebVitals(){(e=>{if(!("PerformanceObserver"in window))return;new PerformanceObserver(t=>{const r=t.getEntries(),s=r[r.length-1];e(s.startTime)}).observe({entryTypes:["largest-contentful-paint"]})})(e=>{this.metrics.largestContentfulPaint=e}),(e=>{if(!("PerformanceObserver"in window))return;new PerformanceObserver(t=>{t.getEntries().forEach(t=>{if("first-input"===t.name){const r=t.processingStart-t.startTime;e(r)}})}).observe({entryTypes:["first-input"]})})(e=>{this.metrics.firstInputDelay=e}),(e=>{if(!("PerformanceObserver"in window))return;let t=0;new PerformanceObserver(r=>{r.getEntries().forEach(r=>{r.hadRecentInput||(t+=r.value,e(t))})}).observe({entryTypes:["layout-shift"]})})(e=>{this.metrics.cumulativeLayoutShift=e})}getMetrics(){return{...this.metrics}}async sendMetrics(e){try{await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({metrics:this.metrics,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href})})}catch(t){}}cleanup(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}};class fe{constructor(){t(this,"preloadedResources",new Set),t(this,"preloadQueue",[]),t(this,"isProcessing",!1)}addToQueue(e,t={}){this.preloadedResources.has(e)||(this.preloadQueue.push(()=>(this.preloadedResources.add(e),((e,t={})=>new Promise((r,s)=>{const n=document.createElement("link");n.rel="preload",n.href=e,t.as&&(n.as=t.as),t.crossOrigin&&(n.crossOrigin=t.crossOrigin),t.priority&&n.setAttribute("importance",t.priority),n.onload=()=>r(),n.onerror=()=>s(new Error(`Failed to preload ${e}`)),document.head.appendChild(n)}))(e,t))),this.isProcessing||this.processQueue())}addImagesToQueue(e){e.forEach(e=>{this.preloadedResources.has(e)||this.preloadQueue.push(()=>(this.preloadedResources.add(e),(e=>Promise.all(e.map(e=>new Promise((t,r)=>{const s=new Image;s.onload=()=>t(s),s.onerror=()=>r(new Error(`Failed to load image: ${e}`)),s.src=e}))))([e]).then(()=>{})))}),this.isProcessing||this.processQueue()}async processQueue(){if(!this.isProcessing&&0!==this.preloadQueue.length){for(this.isProcessing=!0;this.preloadQueue.length>0;){const t=this.preloadQueue.shift();if(t)try{await t()}catch(e){}}this.isProcessing=!1}}clearQueue(){this.preloadQueue=[],this.isProcessing=!1}getPreloadedResources(){return Array.from(this.preloadedResources)}}new class{constructor(){t(this,"hoverTimer",null),t(this,"preloader",new fe),this.initializeHoverPreloading()}initializeHoverPreloading(){document.addEventListener("mouseover",e=>{const t=e.target.closest("a[href]");t&&t.href&&(this.hoverTimer=window.setTimeout(()=>{this.preloadPage(t.href)},200))}),document.addEventListener("mouseout",()=>{this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null)})}preloadPage(e){(e=>{const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)})(e),e.includes("/analysis")?this.preloader.addToQueue("/api/pets",{as:"fetch"}):e.includes("/community")&&this.preloader.addToQueue("/api/community/posts",{as:"fetch"})}preloadForRoute(e){const t={"/analysis":["/api/pets"],"/records":["/api/records"],"/community":["/api/community/posts"],"/profile":["/api/users/profile"]}[e];t&&t.forEach(e=>{this.preloader.addToQueue(e,{as:"fetch"})})}},(e=>{const t=document.createElement("link");t.rel="preconnect",t.href=e,document.head.appendChild(t)})(window.location.origin),window.addEventListener("load",()=>{setTimeout(()=>{he.sendMetrics("/api/analytics/performance").catch(console.error)},2e3)}),M.createRoot(document.getElementById("root")).render(q(n.StrictMode,{children:q(d,{children:q(de,{})})}));export{D as F,K as P,q as a,Q as j,U as u};
