import{a as e,j as t}from"./index-379b094b.js";import{r as a}from"./react-vendor-7927b0b6.js";import{C as r,a as s,L as l,P as i,b as n,p as d,c,d as o,i as m,e as g,A as h,D as u,B as b,f as p}from"./index-797d9c28.js";import{a as y}from"./api-f70ec57c.js";import{a4 as x,m as v,T as N,K as f,B as w,l as C,w as k}from"./ui-vendor-f43192ea.js";import{u as P}from"./usePets-2d4c1e5f.js";import{b as S}from"./router-2b5ad94b.js";import"./utils-2ce30174.js";r.register(s,l,i,n,d,c,o,m);const j=({data:a,title:r="健康趋势",height:s=300,showPercentage:l=!1})=>{const i={labels:a.map(e=>new Date(e.date).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})),datasets:[{label:"健康",data:a.map(e=>l?e.healthyPercentage:e.healthy),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6},{label:"警告",data:a.map(e=>l?e.warningPercentage:e.warning),borderColor:"rgb(251, 191, 36)",backgroundColor:"rgba(251, 191, 36, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6},{label:"异常",data:a.map(e=>l?e.concerningPercentage:e.concerning),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{title:e=>{const t=e[0].dataIndex;return new Date(a[t].date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},afterBody:e=>{const t=e[0].dataIndex,r=a[t];return["",`总记录数: ${r.total}`,l?"":`健康率: ${r.healthyPercentage}%`].filter(Boolean)}}}},scales:{x:{display:!0,title:{display:!0,text:"日期",font:{size:12,weight:"bold"}},grid:{display:!1}},y:{display:!0,title:{display:!0,text:l?"百分比 (%)":"记录数量",font:{size:12,weight:"bold"}},beginAtZero:!0,max:l?100:void 0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{callback:function(e){return l?`${e}%`:e}}}},interaction:{mode:"nearest",axis:"x",intersect:!1},elements:{point:{hoverBackgroundColor:"white",hoverBorderWidth:2}}};return 0===a.length?e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:s},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"📊"}),e("p",{className:"text-gray-500",children:"暂无趋势数据"}),e("p",{className:"text-gray-400 text-sm",children:"需要更多记录来生成趋势图"})]})}):e("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e("div",{style:{height:s},children:e(g,{data:i,options:n})})})};r.register(h,c,o);const $=({healthyCount:a,warningCount:r,concerningCount:s,title:l="健康状态分布",size:i=200,showLegend:n=!0})=>{const d=a+r+s,c={labels:["健康","警告","异常"],datasets:[{data:[a,r,s],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(251, 191, 36, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(251, 191, 36)","rgb(239, 68, 68)"],borderWidth:2,hoverBackgroundColor:["rgba(34, 197, 94, 0.9)","rgba(251, 191, 36, 0.9)","rgba(239, 68, 68, 0.9)"],hoverBorderWidth:3}]},o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:n,position:"bottom",labels:{usePointStyle:!0,padding:20,font:{size:12},generateLabels:e=>{const t=e.data;return t.labels.length&&t.datasets.length?t.labels.map((e,a)=>{const r=t.datasets[0].data[a];return{text:`${e}: ${r} (${d>0?Math.round(r/d*100):0}%)`,fillStyle:t.datasets[0].backgroundColor[a],strokeStyle:t.datasets[0].borderColor[a],lineWidth:t.datasets[0].borderWidth,hidden:!1,index:a}}):[]}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{label:e=>{const t=e.parsed,a=d>0?Math.round(t/d*100):0;return`${e.label}: ${t} 次 (${a}%)`},afterLabel:()=>`总计: ${d} 次`}}},cutout:"60%",elements:{arc:{borderWidth:2}}};return t("div",0===d?{className:"bg-white rounded-lg shadow-sm border p-4",children:[l&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:l}),e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:i},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"📊"}),e("p",{className:"text-gray-500",children:"暂无数据"}),e("p",{className:"text-gray-400 text-sm",children:"开始记录以查看分布"})]})})]}:{className:"bg-white rounded-lg shadow-sm border p-4",children:[l&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:l}),t("div",{className:"relative",style:{height:i},children:[e(u,{data:c,options:o}),e("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t("div",{className:"text-center",children:[e("div",{className:"text-2xl font-bold text-gray-800",children:d}),e("div",{className:"text-sm text-gray-500",children:"总记录"})]})})]})]})};r.register(s,l,b,d,c,o);const R=({shapeDistribution:a,title:r="便便形状分布",height:s=300,horizontal:l=!1})=>{const i={type1:"第1型 - 硬球状",type2:"第2型 - 块状",type3:"第3型 - 裂纹香肠状",type4:"第4型 - 光滑香肠状",type5:"第5型 - 软块状",type6:"第6型 - 糊状",type7:"第7型 - 水状"},n={type1:"rgba(139, 69, 19, 0.8)",type2:"rgba(160, 82, 45, 0.8)",type3:"rgba(210, 180, 140, 0.8)",type4:"rgba(34, 197, 94, 0.8)",type5:"rgba(251, 191, 36, 0.8)",type6:"rgba(249, 115, 22, 0.8)",type7:"rgba(239, 68, 68, 0.8)"},d={type1:"rgb(139, 69, 19)",type2:"rgb(160, 82, 45)",type3:"rgb(210, 180, 140)",type4:"rgb(34, 197, 94)",type5:"rgb(251, 191, 36)",type6:"rgb(249, 115, 22)",type7:"rgb(239, 68, 68)"},c=Object.entries(a).filter(([e,t])=>t>0).sort(([e],[t])=>e.localeCompare(t)),o=c.map(([e])=>i[e]||e),m=c.map(([e,t])=>t),g=c.map(([e])=>n[e]||"rgba(107, 114, 128, 0.8)"),h=c.map(([e])=>d[e]||"rgb(107, 114, 128)"),u=m.reduce((e,t)=>e+t,0),b={labels:o,datasets:[{label:"记录数量",data:m,backgroundColor:g,borderColor:h,borderWidth:2,hoverBackgroundColor:g.map(e=>e.replace("0.8","0.9")),hoverBorderWidth:3}]},y={responsive:!0,maintainAspectRatio:!1,indexAxis:l?"y":"x",plugins:{legend:{display:!1},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{label:e=>{const t=e.parsed[l?"x":"y"];return`数量: ${t} (${u>0?Math.round(t/u*100):0}%)`},afterLabel:()=>`总计: ${u} 次`}}},scales:{x:{display:!0,title:{display:!0,text:l?"记录数量":"便便类型",font:{size:12,weight:"bold"}},grid:{display:l,color:"rgba(0, 0, 0, 0.1)"},ticks:{maxRotation:l?0:45,minRotation:0,font:{size:10}}},y:{display:!0,title:{display:!0,text:l?"便便类型":"记录数量",font:{size:12,weight:"bold"}},beginAtZero:!0,grid:{display:!l,color:"rgba(0, 0, 0, 0.1)"},ticks:{font:{size:10}}}},elements:{bar:{borderRadius:4}}};return 0===c.length?t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[r&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:r}),e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:s},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"📊"}),e("p",{className:"text-gray-500",children:"暂无形状数据"}),e("p",{className:"text-gray-400 text-sm",children:"开始记录以查看分布"})]})})]}):t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e("div",{style:{height:s},children:e(p,{data:b,options:y})}),e("div",{className:"mt-4 text-xs text-gray-600",children:t("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:[e("div",{children:"• 第1-2型：便秘"}),e("div",{children:"• 第3-5型：正常"}),e("div",{children:"• 第6-7型：腹泻"}),e("div",{children:"• 第4型：理想状态"})]})})]})};r.register(s,l,b,d,c,o);const z=({comparison:a,title:r="周期对比分析",height:s=300})=>{const{currentPeriod:l,previousPeriod:i,changes:n}=a,d={labels:["健康记录","警告记录","异常记录","平均置信度","每周频率"],datasets:[{label:"上个"+("week"===l.period?"周":"month"===l.period?"月":"季度"),data:[i.healthyPercentage,i.warningPercentage,i.concerningPercentage,i.averageConfidence,i.frequencyPerWeek],backgroundColor:"rgba(107, 114, 128, 0.6)",borderColor:"rgb(107, 114, 128)",borderWidth:2},{label:"当前"+("week"===l.period?"周":"month"===l.period?"月":"季度"),data:[l.healthyPercentage,l.warningPercentage,l.concerningPercentage,l.averageConfidence,l.frequencyPerWeek],backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgb(59, 130, 246)",borderWidth:2}]};return t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e("div",{style:{height:s},children:e(p,{data:d,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{afterBody:e=>{const t=e[0].dataIndex,a=[n.healthyChange,n.warningChange,n.concerningChange,n.confidenceChange,n.frequencyChange][t];return`变化: ${a>0?`↗ +${a.toFixed(1)}`:a<0?`↘ ${a.toFixed(1)}`:"→ 0"}${["%","%","%","%","次/周"][t]}`}}}},scales:{x:{display:!0,title:{display:!0,text:"指标类型",font:{size:12,weight:"bold"}},grid:{display:!1},ticks:{maxRotation:45,font:{size:10}}},y:{display:!0,title:{display:!0,text:"数值",font:{size:12,weight:"bold"}},beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}}},elements:{bar:{borderRadius:4}}}})}),t("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e("div",{className:"flex items-center justify-between mb-2",children:t("div",{className:"flex items-center space-x-2",children:[e("span",{className:"text-lg",children:(e=>{switch(e){case"improving":return"📈";case"declining":return"📉";default:return"📊"}})(a.trend)}),t("span",{className:`font-semibold ${(e=>{switch(e){case"improving":return"text-green-600";case"declining":return"text-red-600";default:return"text-gray-600"}})(a.trend)}`,children:["总体趋势：",(e=>{switch(e){case"improving":return"改善中";case"declining":return"需要关注";default:return"保持稳定"}})(a.trend)]})]})}),a.significantChanges.length>0&&t("div",{className:"mt-2",children:[e("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"显著变化："}),e("ul",{className:"text-sm text-gray-600 space-y-1",children:a.significantChanges.map((a,r)=>t("li",{className:"flex items-start",children:[e("span",{className:"text-orange-500 mr-1",children:"•"}),a]},r))})]}),0===a.significantChanges.length&&e("p",{className:"text-sm text-gray-600",children:"各项指标变化不大，宠物健康状况相对稳定。"})]})]})};const A=new class{async getHealthTrends(e,t=30,a="daily"){return(await y.get(`/statistics/trends/health/${e}?days=${t}&granularity=${a}`)).data.data}async getPeriodStatistics(e,t="month"){return(await y.get(`/statistics/period/${e}?period=${t}`)).data.data}async getAnomalyPatterns(e,t=30){return(await y.get(`/statistics/anomalies/${e}?window=${t}`)).data.data}async getComparisonAnalysis(e,t="month"){return(await y.get(`/statistics/comparison/${e}?period=${t}`)).data.data}async getMultiPetSummary(e="month"){return(await y.get(`/statistics/summary/multi-pet?period=${e}`)).data.data}async getUserOverview(){return(await y.get("/statistics/overview/user")).data.data}},W=({petId:r,petName:s})=>{const[l,i]=a.useState(!0),[n,d]=a.useState(null),[c,o]=a.useState("month"),[m,g]=a.useState(30),[h,u]=a.useState("trends"),[b,p]=a.useState([]),[y,k]=a.useState(null),[P,S]=a.useState([]),[W,D]=a.useState(null),I=async()=>{try{i(!0),d(null);const[e,t,a,s]=await Promise.all([A.getHealthTrends(r,m,"daily"),A.getPeriodStatistics(r,c),A.getAnomalyPatterns(r,30),A.getComparisonAnalysis(r,c)]);p(e.trends),k(t),S(a.anomalies),D(s)}catch(e){d("加载统计数据失败，请稍后重试")}finally{i(!1)}};a.useEffect(()=>{r&&I()},[r,c,m]);const B=[{id:"trends",label:"健康趋势",icon:N},{id:"distribution",label:"状态分布",icon:f},{id:"comparison",label:"对比分析",icon:w},{id:"anomalies",label:"异常检测",icon:C}],L=e=>{switch(e){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},T=e=>{switch(e){case"high":return"高";case"medium":return"中";case"low":return"低";default:return"未知"}};return l?e("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:t("div",{className:"flex items-center justify-center",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),e("span",{className:"ml-2 text-gray-600",children:"加载统计数据中..."})]})}):n?e("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:t("div",{className:"text-center",children:[e("div",{className:"text-red-500 text-lg mb-2",children:"⚠️"}),e("p",{className:"text-red-600 mb-4",children:n}),e("button",{onClick:I,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"重新加载"})]})}):t("div",{className:"space-y-6",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[t("div",{children:[t("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e(x,{className:"w-5 h-5 mr-2 text-orange-500"}),s," 的健康统计"]}),e("p",{className:"text-gray-600 text-sm mt-1",children:"数据分析和健康趋势监控"})]}),t("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[t("div",{className:"flex items-center space-x-2",children:[e(v,{className:"w-4 h-4 text-gray-500"}),e("select",{value:c,onChange:e=>o(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[{value:"week",label:"本周"},{value:"month",label:"本月"},{value:"quarter",label:"本季度"}].map(t=>e("option",{value:t.value,children:t.label},t.value))})]}),"trends"===h&&t("div",{className:"flex items-center space-x-2",children:[e(N,{className:"w-4 h-4 text-gray-500"}),e("select",{value:m,onChange:e=>g(Number(e.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[{value:7,label:"7天"},{value:14,label:"14天"},{value:30,label:"30天"},{value:60,label:"60天"},{value:90,label:"90天"}].map(t=>e("option",{value:t.value,children:t.label},t.value))})]})]})]})}),t("div",{className:"bg-white rounded-lg shadow-sm border",children:[e("div",{className:"border-b border-gray-200",children:e("nav",{className:"flex space-x-8 px-4",children:B.map(a=>{const r=a.icon;return t("button",{onClick:()=>u(a.id),className:"flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors "+(h===a.id?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e(r,{className:"w-4 h-4"}),e("span",{children:a.label})]},a.id)})})}),t("div",{className:"p-6",children:["trends"===h&&t("div",{className:"space-y-6",children:[e(j,{data:b,title:`${m}天健康趋势`,height:400}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e(j,{data:b,title:"健康率趋势 (%)",height:250,showPercentage:!0}),y&&t("div",{className:"bg-gray-50 rounded-lg p-4",children:[e("h4",{className:"font-semibold text-gray-800 mb-3",children:"统计摘要"}),t("div",{className:"space-y-2 text-sm",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"总记录数："}),e("span",{className:"font-medium",children:y.totalRecords})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"健康率："}),t("span",{className:"font-medium text-green-600",children:[y.healthyPercentage,"%"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"平均置信度："}),t("span",{className:"font-medium",children:[y.averageConfidence,"%"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"每周频率："}),t("span",{className:"font-medium",children:[y.frequencyPerWeek,"次"]})]})]})]})]})]}),"distribution"===h&&y&&t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e($,{healthyCount:y.healthyCount,warningCount:y.warningCount,concerningCount:y.concerningCount,title:"健康状态分布",size:300}),e(R,{shapeDistribution:y.shapeDistribution,title:"便便形状分布",height:350})]}),"comparison"===h&&W&&e(z,{comparison:W,title:("week"===c?"周":"month"===c?"月":"季度")+"度对比分析",height:400}),"anomalies"===h&&t("div",{className:"space-y-4",children:[t("div",{className:"flex items-center justify-between",children:[e("h4",{className:"font-semibold text-gray-800",children:"检测到的异常模式"}),t("span",{className:"text-sm text-gray-600",children:["共发现 ",P.length," 个异常"]})]}),0===P.length?t("div",{className:"text-center py-8",children:[e("div",{className:"text-green-500 text-4xl mb-2",children:"✅"}),e("p",{className:"text-gray-600",children:"未检测到异常模式"}),e("p",{className:"text-gray-500 text-sm",children:"宠物健康状况良好"})]}):e("div",{className:"space-y-4",children:P.map((a,r)=>t("div",{className:"border border-gray-200 rounded-lg p-4",children:[e("div",{className:"flex items-start justify-between mb-2",children:t("div",{className:"flex items-center space-x-2",children:[t("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${L(a.severity)}`,children:[T(a.severity),"风险"]}),e("span",{className:"text-sm text-gray-500",children:new Date(a.detectedAt).toLocaleDateString("zh-CN")})]})}),e("h5",{className:"font-medium text-gray-800 mb-2",children:a.description}),e("div",{className:"text-sm text-gray-600 mb-3",children:t("p",{children:["影响期间：",new Date(a.affectedPeriod.start).toLocaleDateString("zh-CN")," - ",new Date(a.affectedPeriod.end).toLocaleDateString("zh-CN")]})}),a.recommendations.length>0&&t("div",{children:[e("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"建议："}),e("ul",{className:"text-sm text-gray-600 space-y-1",children:a.recommendations.map((a,r)=>t("li",{className:"flex items-start",children:[e("span",{className:"text-orange-500 mr-1",children:"•"}),a]},r))})]})]},r))})]})]})]})]})},D=()=>{const r=S(),{pets:s,loading:l}=P(),[i,n]=a.useState(""),{multiPetSummary:d,userOverview:c,loading:o,error:m,loadMultiPetSummary:g,loadUserOverview:h,clearError:u}=((e={})=>{const{petId:t,period:r="month",trendDays:s=30,granularity:l="daily",autoRefresh:i=!1,refreshInterval:n=3e5}=e,[d,c]=a.useState([]),[o,m]=a.useState(null),[g,h]=a.useState([]),[u,b]=a.useState(null),[p,y]=a.useState(null),[x,v]=a.useState(null),[N,f]=a.useState(!1),[w,C]=a.useState(null),k=a.useCallback(async(e,t=s,a=l)=>{try{C(null);const r=await A.getHealthTrends(e,t,a);c(r.trends)}catch(r){throw C("加载健康趋势失败"),r}},[s,l]),P=a.useCallback(async(e,t=r)=>{try{C(null);const a=await A.getPeriodStatistics(e,t);m(a)}catch(a){throw C("加载周期统计失败"),a}},[r]),S=a.useCallback(async(e,t=30)=>{try{C(null);const a=await A.getAnomalyPatterns(e,t);h(a.anomalies)}catch(a){throw C("加载异常检测失败"),a}},[]),j=a.useCallback(async(e,t=r)=>{try{C(null);const a=await A.getComparisonAnalysis(e,t);b(a)}catch(a){throw C("加载对比分析失败"),a}},[r]),$=a.useCallback(async(e=r)=>{try{C(null);const t=await A.getMultiPetSummary(e);y(t)}catch(t){throw C("加载多宠物汇总失败"),t}},[r]),R=a.useCallback(async()=>{try{C(null);const e=await A.getUserOverview();v(e)}catch(e){throw C("加载用户概览失败"),e}},[]),z=a.useCallback(async e=>{f(!0);try{C(null),await Promise.all([k(e),P(e),S(e),j(e)])}catch(t){C("加载统计数据失败")}finally{f(!1)}},[k,P,S,j]),W=a.useCallback(async()=>{t?await z(t):await Promise.all([$(),R()])},[t,z,$,R]),D=a.useCallback(()=>{C(null)},[]);return a.useEffect(()=>{t&&z(t)},[t,z]),a.useEffect(()=>{if(!i)return;const e=setInterval(()=>{W()},n);return()=>clearInterval(e)},[i,n,W]),{trendData:d,periodStats:o,anomalies:g,comparison:u,multiPetSummary:p,userOverview:x,loading:N,error:w,loadTrends:k,loadPeriodStats:P,loadAnomalies:S,loadComparison:j,loadMultiPetSummary:$,loadUserOverview:R,loadAllData:z,refresh:W,clearError:D}})({autoRefresh:!0,refreshInterval:3e5});a.useEffect(()=>{g(),h()},[g,h]),a.useEffect(()=>{s.length>0&&!i&&n(s[0].id)},[s,i]);const b=s.find(e=>e.id===i);return l||o?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e("p",{className:"text-gray-600",children:"加载统计数据中..."})]})}):m?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center max-w-md",children:[e("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),e("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"加载失败"}),e("p",{className:"text-gray-600 mb-4",children:m}),t("div",{className:"space-x-4",children:[e("button",{onClick:()=>{u(),g(),h()},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"重新加载"}),e("button",{onClick:()=>r("/records"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"返回记录"})]})]})}):0===s.length?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center max-w-md",children:[e("div",{className:"text-gray-400 text-4xl mb-4",children:"🐕"}),e("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"还没有宠物"}),e("p",{className:"text-gray-600 mb-4",children:"请先添加宠物，然后开始记录健康数据"}),t("div",{className:"space-x-4",children:[e("button",{onClick:()=>r("/pets"),className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"添加宠物"}),e("button",{onClick:()=>r("/"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"返回首页"})]})]})}):e("div",{className:"min-h-screen bg-gray-50",children:t("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{className:"mb-6",children:[t("button",{onClick:()=>r("/records"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors mb-4",children:[e(k,{className:"w-4 h-4 mr-1"}),"返回记录"]}),t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e(w,{className:"w-6 h-6 mr-2 text-orange-500"}),"健康统计分析"]}),e("p",{className:"text-gray-600 mt-1",children:"深入了解宠物健康趋势和模式"})]}),s.length>1&&e("div",{className:"mt-4 sm:mt-0",children:e("select",{value:i,onChange:e=>n(e.target.value),className:"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:s.map(e=>t("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))})})]})]}),c&&t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-blue-100 rounded-lg",children:e(f,{className:"w-6 h-6 text-blue-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"总宠物数"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.totalPets})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-green-100 rounded-lg",children:e(N,{className:"w-6 h-6 text-green-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"本月健康率"}),t("p",{className:"text-2xl font-bold text-gray-900",children:[c.summary.healthyRateThisMonth,"%"]})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-orange-100 rounded-lg",children:e(w,{className:"w-6 h-6 text-orange-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"本月记录数"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.summary.totalRecordsThisMonth})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-red-100 rounded-lg",children:e(C,{className:"w-6 h-6 text-red-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"活跃异常"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.summary.activeAnomalies})]})]})})]}),d&&d.petSummaries.length>1&&e("div",{className:"mb-8",children:t("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"多宠物健康概览"}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e($,{healthyCount:d.overallStatistics.averageHealthyPercentage,warningCount:d.overallStatistics.averageWarningPercentage,concerningCount:d.overallStatistics.averageConcerningPercentage,title:"整体健康状态分布",size:250}),t("div",{className:"space-y-3",children:[e("h4",{className:"font-medium text-gray-700",children:"宠物健康状况"}),d.petSummaries.map(a=>{var r,s;return e("div",{className:"p-3 rounded-lg border cursor-pointer transition-colors "+(i===a.petId?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"),onClick:()=>n(a.petId),children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center space-x-3",children:[a.petAvatar?e("img",{src:a.petAvatar,alt:a.petName,className:"w-8 h-8 rounded-full object-cover"}):e("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e("span",{className:"text-gray-500 text-sm",children:"dog"===a.petType?"🐕":"cat"===a.petType?"🐱":"🐾"})}),t("div",{children:[e("p",{className:"font-medium text-gray-800",children:a.petName}),e("p",{className:"text-sm text-gray-500",children:a.petType})]})]}),t("div",{className:"text-right",children:[t("p",{className:"text-sm font-medium text-gray-800",children:[(null==(r=a.statistics)?void 0:r.healthyPercentage)||0,"% 健康"]}),t("p",{className:"text-xs text-gray-500",children:[(null==(s=a.statistics)?void 0:s.totalRecords)||0," 条记录"]}),a.highSeverityAnomalies>0&&t("p",{className:"text-xs text-red-600",children:[a.highSeverityAnomalies," 个高风险异常"]})]})]})},a.petId)})]})]})]})}),b&&e(W,{petId:i,petName:b.name})]})})};export{D as default};
