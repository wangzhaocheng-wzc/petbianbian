import{a as e,j as t}from"./index-379b094b.js";import{r as a}from"./react-vendor-7927b0b6.js";import{C as r,a as s,L as l,P as i,b as n,p as d,c,d as o,i as m,e as g,A as h,D as u,B as b,f as p}from"./index-797d9c28.js";import{a as y}from"./api-f70ec57c.js";import{a4 as x,m as v,T as N,K as f,B as w,l as C,w as k}from"./ui-vendor-f43192ea.js";import{u as P}from"./usePets-2d4c1e5f.js";import{b as S}from"./router-2b5ad94b.js";import"./utils-2ce30174.js";r.register(s,l,i,n,d,c,o,m);const j=({data:a,title:r="å¥åº·è¶‹åŠ¿",height:s=300,showPercentage:l=!1})=>{const i={labels:a.map(e=>new Date(e.date).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})),datasets:[{label:"å¥åº·",data:a.map(e=>l?e.healthyPercentage:e.healthy),borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6},{label:"è­¦å‘Š",data:a.map(e=>l?e.warningPercentage:e.warning),borderColor:"rgb(251, 191, 36)",backgroundColor:"rgba(251, 191, 36, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6},{label:"å¼‚å¸¸",data:a.map(e=>l?e.concerningPercentage:e.concerning),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6}]},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{title:e=>{const t=e[0].dataIndex;return new Date(a[t].date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},afterBody:e=>{const t=e[0].dataIndex,r=a[t];return["",`æ€»è®°å½•æ•°: ${r.total}`,l?"":`å¥åº·çŽ‡: ${r.healthyPercentage}%`].filter(Boolean)}}}},scales:{x:{display:!0,title:{display:!0,text:"æ—¥æœŸ",font:{size:12,weight:"bold"}},grid:{display:!1}},y:{display:!0,title:{display:!0,text:l?"ç™¾åˆ†æ¯” (%)":"è®°å½•æ•°é‡",font:{size:12,weight:"bold"}},beginAtZero:!0,max:l?100:void 0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{callback:function(e){return l?`${e}%`:e}}}},interaction:{mode:"nearest",axis:"x",intersect:!1},elements:{point:{hoverBackgroundColor:"white",hoverBorderWidth:2}}};return 0===a.length?e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:s},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"ðŸ“Š"}),e("p",{className:"text-gray-500",children:"æš‚æ— è¶‹åŠ¿æ•°æ®"}),e("p",{className:"text-gray-400 text-sm",children:"éœ€è¦æ›´å¤šè®°å½•æ¥ç”Ÿæˆè¶‹åŠ¿å›¾"})]})}):e("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:e("div",{style:{height:s},children:e(g,{data:i,options:n})})})};r.register(h,c,o);const $=({healthyCount:a,warningCount:r,concerningCount:s,title:l="å¥åº·çŠ¶æ€åˆ†å¸ƒ",size:i=200,showLegend:n=!0})=>{const d=a+r+s,c={labels:["å¥åº·","è­¦å‘Š","å¼‚å¸¸"],datasets:[{data:[a,r,s],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(251, 191, 36, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(251, 191, 36)","rgb(239, 68, 68)"],borderWidth:2,hoverBackgroundColor:["rgba(34, 197, 94, 0.9)","rgba(251, 191, 36, 0.9)","rgba(239, 68, 68, 0.9)"],hoverBorderWidth:3}]},o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:n,position:"bottom",labels:{usePointStyle:!0,padding:20,font:{size:12},generateLabels:e=>{const t=e.data;return t.labels.length&&t.datasets.length?t.labels.map((e,a)=>{const r=t.datasets[0].data[a];return{text:`${e}: ${r} (${d>0?Math.round(r/d*100):0}%)`,fillStyle:t.datasets[0].backgroundColor[a],strokeStyle:t.datasets[0].borderColor[a],lineWidth:t.datasets[0].borderWidth,hidden:!1,index:a}}):[]}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{label:e=>{const t=e.parsed,a=d>0?Math.round(t/d*100):0;return`${e.label}: ${t} æ¬¡ (${a}%)`},afterLabel:()=>`æ€»è®¡: ${d} æ¬¡`}}},cutout:"60%",elements:{arc:{borderWidth:2}}};return t("div",0===d?{className:"bg-white rounded-lg shadow-sm border p-4",children:[l&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:l}),e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:i},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"ðŸ“Š"}),e("p",{className:"text-gray-500",children:"æš‚æ— æ•°æ®"}),e("p",{className:"text-gray-400 text-sm",children:"å¼€å§‹è®°å½•ä»¥æŸ¥çœ‹åˆ†å¸ƒ"})]})})]}:{className:"bg-white rounded-lg shadow-sm border p-4",children:[l&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:l}),t("div",{className:"relative",style:{height:i},children:[e(u,{data:c,options:o}),e("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t("div",{className:"text-center",children:[e("div",{className:"text-2xl font-bold text-gray-800",children:d}),e("div",{className:"text-sm text-gray-500",children:"æ€»è®°å½•"})]})})]})]})};r.register(s,l,b,d,c,o);const R=({shapeDistribution:a,title:r="ä¾¿ä¾¿å½¢çŠ¶åˆ†å¸ƒ",height:s=300,horizontal:l=!1})=>{const i={type1:"ç¬¬1åž‹ - ç¡¬çƒçŠ¶",type2:"ç¬¬2åž‹ - å—çŠ¶",type3:"ç¬¬3åž‹ - è£‚çº¹é¦™è‚ çŠ¶",type4:"ç¬¬4åž‹ - å…‰æ»‘é¦™è‚ çŠ¶",type5:"ç¬¬5åž‹ - è½¯å—çŠ¶",type6:"ç¬¬6åž‹ - ç³ŠçŠ¶",type7:"ç¬¬7åž‹ - æ°´çŠ¶"},n={type1:"rgba(139, 69, 19, 0.8)",type2:"rgba(160, 82, 45, 0.8)",type3:"rgba(210, 180, 140, 0.8)",type4:"rgba(34, 197, 94, 0.8)",type5:"rgba(251, 191, 36, 0.8)",type6:"rgba(249, 115, 22, 0.8)",type7:"rgba(239, 68, 68, 0.8)"},d={type1:"rgb(139, 69, 19)",type2:"rgb(160, 82, 45)",type3:"rgb(210, 180, 140)",type4:"rgb(34, 197, 94)",type5:"rgb(251, 191, 36)",type6:"rgb(249, 115, 22)",type7:"rgb(239, 68, 68)"},c=Object.entries(a).filter(([e,t])=>t>0).sort(([e],[t])=>e.localeCompare(t)),o=c.map(([e])=>i[e]||e),m=c.map(([e,t])=>t),g=c.map(([e])=>n[e]||"rgba(107, 114, 128, 0.8)"),h=c.map(([e])=>d[e]||"rgb(107, 114, 128)"),u=m.reduce((e,t)=>e+t,0),b={labels:o,datasets:[{label:"è®°å½•æ•°é‡",data:m,backgroundColor:g,borderColor:h,borderWidth:2,hoverBackgroundColor:g.map(e=>e.replace("0.8","0.9")),hoverBorderWidth:3}]},y={responsive:!0,maintainAspectRatio:!1,indexAxis:l?"y":"x",plugins:{legend:{display:!1},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{label:e=>{const t=e.parsed[l?"x":"y"];return`æ•°é‡: ${t} (${u>0?Math.round(t/u*100):0}%)`},afterLabel:()=>`æ€»è®¡: ${u} æ¬¡`}}},scales:{x:{display:!0,title:{display:!0,text:l?"è®°å½•æ•°é‡":"ä¾¿ä¾¿ç±»åž‹",font:{size:12,weight:"bold"}},grid:{display:l,color:"rgba(0, 0, 0, 0.1)"},ticks:{maxRotation:l?0:45,minRotation:0,font:{size:10}}},y:{display:!0,title:{display:!0,text:l?"ä¾¿ä¾¿ç±»åž‹":"è®°å½•æ•°é‡",font:{size:12,weight:"bold"}},beginAtZero:!0,grid:{display:!l,color:"rgba(0, 0, 0, 0.1)"},ticks:{font:{size:10}}}},elements:{bar:{borderRadius:4}}};return 0===c.length?t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[r&&e("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:r}),e("div",{className:"flex items-center justify-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",style:{height:s},children:t("div",{className:"text-center",children:[e("div",{className:"text-gray-400 text-lg mb-2",children:"ðŸ“Š"}),e("p",{className:"text-gray-500",children:"æš‚æ— å½¢çŠ¶æ•°æ®"}),e("p",{className:"text-gray-400 text-sm",children:"å¼€å§‹è®°å½•ä»¥æŸ¥çœ‹åˆ†å¸ƒ"})]})})]}):t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e("div",{style:{height:s},children:e(p,{data:b,options:y})}),e("div",{className:"mt-4 text-xs text-gray-600",children:t("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1",children:[e("div",{children:"â€¢ ç¬¬1-2åž‹ï¼šä¾¿ç§˜"}),e("div",{children:"â€¢ ç¬¬3-5åž‹ï¼šæ­£å¸¸"}),e("div",{children:"â€¢ ç¬¬6-7åž‹ï¼šè…¹æ³»"}),e("div",{children:"â€¢ ç¬¬4åž‹ï¼šç†æƒ³çŠ¶æ€"})]})})]})};r.register(s,l,b,d,c,o);const z=({comparison:a,title:r="å‘¨æœŸå¯¹æ¯”åˆ†æž",height:s=300})=>{const{currentPeriod:l,previousPeriod:i,changes:n}=a,d={labels:["å¥åº·è®°å½•","è­¦å‘Šè®°å½•","å¼‚å¸¸è®°å½•","å¹³å‡ç½®ä¿¡åº¦","æ¯å‘¨é¢‘çŽ‡"],datasets:[{label:"ä¸Šä¸ª"+("week"===l.period?"å‘¨":"month"===l.period?"æœˆ":"å­£åº¦"),data:[i.healthyPercentage,i.warningPercentage,i.concerningPercentage,i.averageConfidence,i.frequencyPerWeek],backgroundColor:"rgba(107, 114, 128, 0.6)",borderColor:"rgb(107, 114, 128)",borderWidth:2},{label:"å½“å‰"+("week"===l.period?"å‘¨":"month"===l.period?"æœˆ":"å­£åº¦"),data:[l.healthyPercentage,l.warningPercentage,l.concerningPercentage,l.averageConfidence,l.frequencyPerWeek],backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgb(59, 130, 246)",borderWidth:2}]};return t("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:[e("div",{style:{height:s},children:e(p,{data:d,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},title:{display:!!r,text:r,font:{size:16,weight:"bold"},padding:{bottom:20}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{afterBody:e=>{const t=e[0].dataIndex,a=[n.healthyChange,n.warningChange,n.concerningChange,n.confidenceChange,n.frequencyChange][t];return`å˜åŒ–: ${a>0?`â†— +${a.toFixed(1)}`:a<0?`â†˜ ${a.toFixed(1)}`:"â†’ 0"}${["%","%","%","%","æ¬¡/å‘¨"][t]}`}}}},scales:{x:{display:!0,title:{display:!0,text:"æŒ‡æ ‡ç±»åž‹",font:{size:12,weight:"bold"}},grid:{display:!1},ticks:{maxRotation:45,font:{size:10}}},y:{display:!0,title:{display:!0,text:"æ•°å€¼",font:{size:12,weight:"bold"}},beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}}},elements:{bar:{borderRadius:4}}}})}),t("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e("div",{className:"flex items-center justify-between mb-2",children:t("div",{className:"flex items-center space-x-2",children:[e("span",{className:"text-lg",children:(e=>{switch(e){case"improving":return"ðŸ“ˆ";case"declining":return"ðŸ“‰";default:return"ðŸ“Š"}})(a.trend)}),t("span",{className:`font-semibold ${(e=>{switch(e){case"improving":return"text-green-600";case"declining":return"text-red-600";default:return"text-gray-600"}})(a.trend)}`,children:["æ€»ä½“è¶‹åŠ¿ï¼š",(e=>{switch(e){case"improving":return"æ”¹å–„ä¸­";case"declining":return"éœ€è¦å…³æ³¨";default:return"ä¿æŒç¨³å®š"}})(a.trend)]})]})}),a.significantChanges.length>0&&t("div",{className:"mt-2",children:[e("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"æ˜¾è‘—å˜åŒ–ï¼š"}),e("ul",{className:"text-sm text-gray-600 space-y-1",children:a.significantChanges.map((a,r)=>t("li",{className:"flex items-start",children:[e("span",{className:"text-orange-500 mr-1",children:"â€¢"}),a]},r))})]}),0===a.significantChanges.length&&e("p",{className:"text-sm text-gray-600",children:"å„é¡¹æŒ‡æ ‡å˜åŒ–ä¸å¤§ï¼Œå® ç‰©å¥åº·çŠ¶å†µç›¸å¯¹ç¨³å®šã€‚"})]})]})};const A=new class{async getHealthTrends(e,t=30,a="daily"){return(await y.get(`/statistics/trends/health/${e}?days=${t}&granularity=${a}`)).data.data}async getPeriodStatistics(e,t="month"){return(await y.get(`/statistics/period/${e}?period=${t}`)).data.data}async getAnomalyPatterns(e,t=30){return(await y.get(`/statistics/anomalies/${e}?window=${t}`)).data.data}async getComparisonAnalysis(e,t="month"){return(await y.get(`/statistics/comparison/${e}?period=${t}`)).data.data}async getMultiPetSummary(e="month"){return(await y.get(`/statistics/summary/multi-pet?period=${e}`)).data.data}async getUserOverview(){return(await y.get("/statistics/overview/user")).data.data}},W=({petId:r,petName:s})=>{const[l,i]=a.useState(!0),[n,d]=a.useState(null),[c,o]=a.useState("month"),[m,g]=a.useState(30),[h,u]=a.useState("trends"),[b,p]=a.useState([]),[y,k]=a.useState(null),[P,S]=a.useState([]),[W,D]=a.useState(null),I=async()=>{try{i(!0),d(null);const[e,t,a,s]=await Promise.all([A.getHealthTrends(r,m,"daily"),A.getPeriodStatistics(r,c),A.getAnomalyPatterns(r,30),A.getComparisonAnalysis(r,c)]);p(e.trends),k(t),S(a.anomalies),D(s)}catch(e){d("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{i(!1)}};a.useEffect(()=>{r&&I()},[r,c,m]);const B=[{id:"trends",label:"å¥åº·è¶‹åŠ¿",icon:N},{id:"distribution",label:"çŠ¶æ€åˆ†å¸ƒ",icon:f},{id:"comparison",label:"å¯¹æ¯”åˆ†æž",icon:w},{id:"anomalies",label:"å¼‚å¸¸æ£€æµ‹",icon:C}],L=e=>{switch(e){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},T=e=>{switch(e){case"high":return"é«˜";case"medium":return"ä¸­";case"low":return"ä½Ž";default:return"æœªçŸ¥"}};return l?e("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:t("div",{className:"flex items-center justify-center",children:[e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),e("span",{className:"ml-2 text-gray-600",children:"åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­..."})]})}):n?e("div",{className:"bg-white rounded-lg shadow-sm border p-8",children:t("div",{className:"text-center",children:[e("div",{className:"text-red-500 text-lg mb-2",children:"âš ï¸"}),e("p",{className:"text-red-600 mb-4",children:n}),e("button",{onClick:I,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"é‡æ–°åŠ è½½"})]})}):t("div",{className:"space-y-6",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[t("div",{children:[t("h2",{className:"text-xl font-bold text-gray-800 flex items-center",children:[e(x,{className:"w-5 h-5 mr-2 text-orange-500"}),s," çš„å¥åº·ç»Ÿè®¡"]}),e("p",{className:"text-gray-600 text-sm mt-1",children:"æ•°æ®åˆ†æžå’Œå¥åº·è¶‹åŠ¿ç›‘æŽ§"})]}),t("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[t("div",{className:"flex items-center space-x-2",children:[e(v,{className:"w-4 h-4 text-gray-500"}),e("select",{value:c,onChange:e=>o(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[{value:"week",label:"æœ¬å‘¨"},{value:"month",label:"æœ¬æœˆ"},{value:"quarter",label:"æœ¬å­£åº¦"}].map(t=>e("option",{value:t.value,children:t.label},t.value))})]}),"trends"===h&&t("div",{className:"flex items-center space-x-2",children:[e(N,{className:"w-4 h-4 text-gray-500"}),e("select",{value:m,onChange:e=>g(Number(e.target.value)),className:"border border-gray-300 rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500",children:[{value:7,label:"7å¤©"},{value:14,label:"14å¤©"},{value:30,label:"30å¤©"},{value:60,label:"60å¤©"},{value:90,label:"90å¤©"}].map(t=>e("option",{value:t.value,children:t.label},t.value))})]})]})]})}),t("div",{className:"bg-white rounded-lg shadow-sm border",children:[e("div",{className:"border-b border-gray-200",children:e("nav",{className:"flex space-x-8 px-4",children:B.map(a=>{const r=a.icon;return t("button",{onClick:()=>u(a.id),className:"flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors "+(h===a.id?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e(r,{className:"w-4 h-4"}),e("span",{children:a.label})]},a.id)})})}),t("div",{className:"p-6",children:["trends"===h&&t("div",{className:"space-y-6",children:[e(j,{data:b,title:`${m}å¤©å¥åº·è¶‹åŠ¿`,height:400}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e(j,{data:b,title:"å¥åº·çŽ‡è¶‹åŠ¿ (%)",height:250,showPercentage:!0}),y&&t("div",{className:"bg-gray-50 rounded-lg p-4",children:[e("h4",{className:"font-semibold text-gray-800 mb-3",children:"ç»Ÿè®¡æ‘˜è¦"}),t("div",{className:"space-y-2 text-sm",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"æ€»è®°å½•æ•°ï¼š"}),e("span",{className:"font-medium",children:y.totalRecords})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"å¥åº·çŽ‡ï¼š"}),t("span",{className:"font-medium text-green-600",children:[y.healthyPercentage,"%"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"å¹³å‡ç½®ä¿¡åº¦ï¼š"}),t("span",{className:"font-medium",children:[y.averageConfidence,"%"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-gray-600",children:"æ¯å‘¨é¢‘çŽ‡ï¼š"}),t("span",{className:"font-medium",children:[y.frequencyPerWeek,"æ¬¡"]})]})]})]})]})]}),"distribution"===h&&y&&t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e($,{healthyCount:y.healthyCount,warningCount:y.warningCount,concerningCount:y.concerningCount,title:"å¥åº·çŠ¶æ€åˆ†å¸ƒ",size:300}),e(R,{shapeDistribution:y.shapeDistribution,title:"ä¾¿ä¾¿å½¢çŠ¶åˆ†å¸ƒ",height:350})]}),"comparison"===h&&W&&e(z,{comparison:W,title:("week"===c?"å‘¨":"month"===c?"æœˆ":"å­£åº¦")+"åº¦å¯¹æ¯”åˆ†æž",height:400}),"anomalies"===h&&t("div",{className:"space-y-4",children:[t("div",{className:"flex items-center justify-between",children:[e("h4",{className:"font-semibold text-gray-800",children:"æ£€æµ‹åˆ°çš„å¼‚å¸¸æ¨¡å¼"}),t("span",{className:"text-sm text-gray-600",children:["å…±å‘çŽ° ",P.length," ä¸ªå¼‚å¸¸"]})]}),0===P.length?t("div",{className:"text-center py-8",children:[e("div",{className:"text-green-500 text-4xl mb-2",children:"âœ…"}),e("p",{className:"text-gray-600",children:"æœªæ£€æµ‹åˆ°å¼‚å¸¸æ¨¡å¼"}),e("p",{className:"text-gray-500 text-sm",children:"å® ç‰©å¥åº·çŠ¶å†µè‰¯å¥½"})]}):e("div",{className:"space-y-4",children:P.map((a,r)=>t("div",{className:"border border-gray-200 rounded-lg p-4",children:[e("div",{className:"flex items-start justify-between mb-2",children:t("div",{className:"flex items-center space-x-2",children:[t("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${L(a.severity)}`,children:[T(a.severity),"é£Žé™©"]}),e("span",{className:"text-sm text-gray-500",children:new Date(a.detectedAt).toLocaleDateString("zh-CN")})]})}),e("h5",{className:"font-medium text-gray-800 mb-2",children:a.description}),e("div",{className:"text-sm text-gray-600 mb-3",children:t("p",{children:["å½±å“æœŸé—´ï¼š",new Date(a.affectedPeriod.start).toLocaleDateString("zh-CN")," - ",new Date(a.affectedPeriod.end).toLocaleDateString("zh-CN")]})}),a.recommendations.length>0&&t("div",{children:[e("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"å»ºè®®ï¼š"}),e("ul",{className:"text-sm text-gray-600 space-y-1",children:a.recommendations.map((a,r)=>t("li",{className:"flex items-start",children:[e("span",{className:"text-orange-500 mr-1",children:"â€¢"}),a]},r))})]})]},r))})]})]})]})]})},D=()=>{const r=S(),{pets:s,loading:l}=P(),[i,n]=a.useState(""),{multiPetSummary:d,userOverview:c,loading:o,error:m,loadMultiPetSummary:g,loadUserOverview:h,clearError:u}=((e={})=>{const{petId:t,period:r="month",trendDays:s=30,granularity:l="daily",autoRefresh:i=!1,refreshInterval:n=3e5}=e,[d,c]=a.useState([]),[o,m]=a.useState(null),[g,h]=a.useState([]),[u,b]=a.useState(null),[p,y]=a.useState(null),[x,v]=a.useState(null),[N,f]=a.useState(!1),[w,C]=a.useState(null),k=a.useCallback(async(e,t=s,a=l)=>{try{C(null);const r=await A.getHealthTrends(e,t,a);c(r.trends)}catch(r){throw C("åŠ è½½å¥åº·è¶‹åŠ¿å¤±è´¥"),r}},[s,l]),P=a.useCallback(async(e,t=r)=>{try{C(null);const a=await A.getPeriodStatistics(e,t);m(a)}catch(a){throw C("åŠ è½½å‘¨æœŸç»Ÿè®¡å¤±è´¥"),a}},[r]),S=a.useCallback(async(e,t=30)=>{try{C(null);const a=await A.getAnomalyPatterns(e,t);h(a.anomalies)}catch(a){throw C("åŠ è½½å¼‚å¸¸æ£€æµ‹å¤±è´¥"),a}},[]),j=a.useCallback(async(e,t=r)=>{try{C(null);const a=await A.getComparisonAnalysis(e,t);b(a)}catch(a){throw C("åŠ è½½å¯¹æ¯”åˆ†æžå¤±è´¥"),a}},[r]),$=a.useCallback(async(e=r)=>{try{C(null);const t=await A.getMultiPetSummary(e);y(t)}catch(t){throw C("åŠ è½½å¤šå® ç‰©æ±‡æ€»å¤±è´¥"),t}},[r]),R=a.useCallback(async()=>{try{C(null);const e=await A.getUserOverview();v(e)}catch(e){throw C("åŠ è½½ç”¨æˆ·æ¦‚è§ˆå¤±è´¥"),e}},[]),z=a.useCallback(async e=>{f(!0);try{C(null),await Promise.all([k(e),P(e),S(e),j(e)])}catch(t){C("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥")}finally{f(!1)}},[k,P,S,j]),W=a.useCallback(async()=>{t?await z(t):await Promise.all([$(),R()])},[t,z,$,R]),D=a.useCallback(()=>{C(null)},[]);return a.useEffect(()=>{t&&z(t)},[t,z]),a.useEffect(()=>{if(!i)return;const e=setInterval(()=>{W()},n);return()=>clearInterval(e)},[i,n,W]),{trendData:d,periodStats:o,anomalies:g,comparison:u,multiPetSummary:p,userOverview:x,loading:N,error:w,loadTrends:k,loadPeriodStats:P,loadAnomalies:S,loadComparison:j,loadMultiPetSummary:$,loadUserOverview:R,loadAllData:z,refresh:W,clearError:D}})({autoRefresh:!0,refreshInterval:3e5});a.useEffect(()=>{g(),h()},[g,h]),a.useEffect(()=>{s.length>0&&!i&&n(s[0].id)},[s,i]);const b=s.find(e=>e.id===i);return l||o?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e("p",{className:"text-gray-600",children:"åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­..."})]})}):m?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center max-w-md",children:[e("div",{className:"text-red-500 text-4xl mb-4",children:"âš ï¸"}),e("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"åŠ è½½å¤±è´¥"}),e("p",{className:"text-gray-600 mb-4",children:m}),t("div",{className:"space-x-4",children:[e("button",{onClick:()=>{u(),g(),h()},className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"é‡æ–°åŠ è½½"}),e("button",{onClick:()=>r("/records"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"è¿”å›žè®°å½•"})]})]})}):0===s.length?e("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t("div",{className:"text-center max-w-md",children:[e("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ•"}),e("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"è¿˜æ²¡æœ‰å® ç‰©"}),e("p",{className:"text-gray-600 mb-4",children:"è¯·å…ˆæ·»åŠ å® ç‰©ï¼Œç„¶åŽå¼€å§‹è®°å½•å¥åº·æ•°æ®"}),t("div",{className:"space-x-4",children:[e("button",{onClick:()=>r("/pets"),className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"æ·»åŠ å® ç‰©"}),e("button",{onClick:()=>r("/"),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"è¿”å›žé¦–é¡µ"})]})]})}):e("div",{className:"min-h-screen bg-gray-50",children:t("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{className:"mb-6",children:[t("button",{onClick:()=>r("/records"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors mb-4",children:[e(k,{className:"w-4 h-4 mr-1"}),"è¿”å›žè®°å½•"]}),t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e(w,{className:"w-6 h-6 mr-2 text-orange-500"}),"å¥åº·ç»Ÿè®¡åˆ†æž"]}),e("p",{className:"text-gray-600 mt-1",children:"æ·±å…¥äº†è§£å® ç‰©å¥åº·è¶‹åŠ¿å’Œæ¨¡å¼"})]}),s.length>1&&e("div",{className:"mt-4 sm:mt-0",children:e("select",{value:i,onChange:e=>n(e.target.value),className:"border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500",children:s.map(e=>t("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))})})]})]}),c&&t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-blue-100 rounded-lg",children:e(f,{className:"w-6 h-6 text-blue-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"æ€»å® ç‰©æ•°"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.totalPets})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-green-100 rounded-lg",children:e(N,{className:"w-6 h-6 text-green-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"æœ¬æœˆå¥åº·çŽ‡"}),t("p",{className:"text-2xl font-bold text-gray-900",children:[c.summary.healthyRateThisMonth,"%"]})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-orange-100 rounded-lg",children:e(w,{className:"w-6 h-6 text-orange-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"æœ¬æœˆè®°å½•æ•°"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.summary.totalRecordsThisMonth})]})]})}),e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:t("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-red-100 rounded-lg",children:e(C,{className:"w-6 h-6 text-red-600"})}),t("div",{className:"ml-4",children:[e("p",{className:"text-sm font-medium text-gray-600",children:"æ´»è·ƒå¼‚å¸¸"}),e("p",{className:"text-2xl font-bold text-gray-900",children:c.summary.activeAnomalies})]})]})})]}),d&&d.petSummaries.length>1&&e("div",{className:"mb-8",children:t("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"å¤šå® ç‰©å¥åº·æ¦‚è§ˆ"}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e($,{healthyCount:d.overallStatistics.averageHealthyPercentage,warningCount:d.overallStatistics.averageWarningPercentage,concerningCount:d.overallStatistics.averageConcerningPercentage,title:"æ•´ä½“å¥åº·çŠ¶æ€åˆ†å¸ƒ",size:250}),t("div",{className:"space-y-3",children:[e("h4",{className:"font-medium text-gray-700",children:"å® ç‰©å¥åº·çŠ¶å†µ"}),d.petSummaries.map(a=>{var r,s;return e("div",{className:"p-3 rounded-lg border cursor-pointer transition-colors "+(i===a.petId?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"),onClick:()=>n(a.petId),children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center space-x-3",children:[a.petAvatar?e("img",{src:a.petAvatar,alt:a.petName,className:"w-8 h-8 rounded-full object-cover"}):e("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e("span",{className:"text-gray-500 text-sm",children:"dog"===a.petType?"ðŸ•":"cat"===a.petType?"ðŸ±":"ðŸ¾"})}),t("div",{children:[e("p",{className:"font-medium text-gray-800",children:a.petName}),e("p",{className:"text-sm text-gray-500",children:a.petType})]})]}),t("div",{className:"text-right",children:[t("p",{className:"text-sm font-medium text-gray-800",children:[(null==(r=a.statistics)?void 0:r.healthyPercentage)||0,"% å¥åº·"]}),t("p",{className:"text-xs text-gray-500",children:[(null==(s=a.statistics)?void 0:s.totalRecords)||0," æ¡è®°å½•"]}),a.highSeverityAnomalies>0&&t("p",{className:"text-xs text-red-600",children:[a.highSeverityAnomalies," ä¸ªé«˜é£Žé™©å¼‚å¸¸"]})]})]})},a.petId)})]})]})]})}),b&&e(W,{petId:i,petName:b.name})]})})};export{D as default};
