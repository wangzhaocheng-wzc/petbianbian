import{j as e,a,u as t}from"./index-379b094b.js";import{r}from"./react-vendor-7927b0b6.js";import{y as s,F as l,q as n,m as c,g as d,z as i,p as o,G as m,J as h,A as g,l as u,i as x,X as p,D as y,r as N,s as b,t as v,o as f,B as w,K as S,a as C,N as k}from"./ui-vendor-f43192ea.js";import{a as j}from"./api-f70ec57c.js";import"./router-2b5ad94b.js";import"./utils-2ce30174.js";const R=({records:t,pagination:p,filters:y,loading:N,onFiltersChange:b,onViewRecord:v,onEditRecord:f,onDeleteRecord:w,onBatchDelete:S})=>{const[C,k]=r.useState([]),[j,R]=r.useState(!1),[D,P]=r.useState(y.search||""),$=e=>{b({page:e})},A=e=>{switch(e){case"healthy":return a(x,{className:"w-5 h-5 text-green-500"});case"warning":return a(u,{className:"w-5 h-5 text-yellow-500"});case"concerning":return a(g,{className:"w-5 h-5 text-red-500"});default:return a(g,{className:"w-5 h-5 text-gray-400"})}},F=e=>{switch(e){case"healthy":return"bg-green-100 text-green-800";case"warning":return"bg-yellow-100 text-yellow-800";case"concerning":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e("div",{className:"bg-white rounded-lg shadow",children:[e("div",{className:"p-4 border-b border-gray-200",children:[e("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[a("form",{onSubmit:e=>{e.preventDefault(),b({search:D,page:1})},className:"flex-1 max-w-md",children:e("div",{className:"relative",children:[a(s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),a("input",{type:"text",placeholder:"搜索记录...",value:D,onChange:e=>P(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})}),e("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>R(!j),className:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:[a(l,{className:"w-4 h-4"}),"筛选"]}),C.length>0&&e("button",{onClick:()=>{C.length>0&&S&&(S(C),k([]))},className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:text-red-800 border border-red-300 rounded-lg hover:bg-red-50",children:[a(n,{className:"w-4 h-4"}),"删除选中 (",C.length,")"]})]})]}),j&&e("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"健康状态"}),e("select",{value:y.healthStatus||"",onChange:e=>b({healthStatus:e.target.value,page:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[a("option",{value:"",children:"全部"}),a("option",{value:"healthy",children:"健康"}),a("option",{value:"warning",children:"警告"}),a("option",{value:"concerning",children:"异常"})]})]}),e("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"开始日期"}),a("input",{type:"date",value:y.startDate||"",onChange:e=>b({startDate:e.target.value,page:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"结束日期"}),a("input",{type:"date",value:y.endDate||"",onChange:e=>b({endDate:e.target.value,page:1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),a("div",{className:"mt-4 flex justify-end",children:a("button",{onClick:()=>{b({healthStatus:void 0,startDate:void 0,endDate:void 0,search:void 0,page:1}),P("")},className:"px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50",children:"清除筛选"})})]})]}),a("div",{className:"overflow-x-auto",children:N?e("div",{className:"p-8 text-center",children:[a("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),a("p",{className:"mt-2 text-gray-600",children:"加载中..."})]}):0===t.length?e("div",{className:"p-8 text-center text-gray-500",children:[a(c,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),a("p",{children:"暂无记录"})]}):e("table",{className:"w-full",children:[a("thead",{className:"bg-gray-50",children:e("tr",{children:[a("th",{className:"px-4 py-3 text-left",children:a("input",{type:"checkbox",checked:C.length===t.length&&t.length>0,onChange:()=>{C.length===t.length?k([]):k(t.map(e=>e.id))},className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"})}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"宠物"}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"健康状态"}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"置信度"}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"备注"}),a("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),a("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(t=>{return e("tr",{className:"hover:bg-gray-50",children:[a("td",{className:"px-4 py-4",children:a("input",{type:"checkbox",checked:C.includes(t.id),onChange:()=>{return e=t.id,void k(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e]);var e},className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"})}),a("td",{className:"px-4 py-4",children:e("div",{className:"flex items-center",children:[t.pet.avatar?a("img",{src:t.pet.avatar,alt:t.pet.name,className:"w-8 h-8 rounded-full mr-3"}):a("div",{className:"w-8 h-8 bg-gray-200 rounded-full mr-3 flex items-center justify-center",children:a("span",{className:"text-xs text-gray-500",children:t.pet.name.charAt(0)})}),e("div",{children:[a("div",{className:"text-sm font-medium text-gray-900",children:t.pet.name}),a("div",{className:"text-sm text-gray-500",children:t.pet.breed||t.pet.type})]})]})}),a("td",{className:"px-4 py-4",children:e("div",{className:"flex items-center",children:[A(t.analysis.healthStatus),a("span",{className:`ml-2 px-2 py-1 text-xs font-medium rounded-full ${F(t.analysis.healthStatus)}`,children:t.analysis.healthStatusDescription})]})}),e("td",{className:"px-4 py-4 text-sm text-gray-900",children:[t.analysis.confidence,"%"]}),a("td",{className:"px-4 py-4 text-sm text-gray-900",children:(r=t.timestamp,new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))}),a("td",{className:"px-4 py-4 text-sm text-gray-500 max-w-xs truncate",children:t.userNotes||"-"}),a("td",{className:"px-4 py-4",children:e("div",{className:"flex items-center gap-2",children:[a("button",{onClick:()=>v(t),className:"text-blue-600 hover:text-blue-800",title:"查看详情",children:a(d,{className:"w-4 h-4"})}),a("button",{onClick:()=>f(t),className:"text-green-600 hover:text-green-800",title:"编辑",children:a(i,{className:"w-4 h-4"})}),a("button",{onClick:()=>w(t),className:"text-red-600 hover:text-red-800",title:"删除",children:a(n,{className:"w-4 h-4"})}),t.isShared&&a(o,{className:"w-4 h-4 text-gray-400"})]})})]},t.id);var r})})]})}),p&&p.totalPages>1&&e("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[e("div",{className:"text-sm text-gray-700",children:["显示 ",(p.page-1)*p.limit+1," 到"," ",Math.min(p.page*p.limit,p.total)," 条， 共 ",p.total," 条记录"]}),e("div",{className:"flex items-center gap-2",children:[e("button",{onClick:()=>$(p.page-1),disabled:!p.hasPrev,className:"flex items-center gap-1 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[a(m,{className:"w-4 h-4"}),"上一页"]}),e("span",{className:"px-3 py-2 text-sm text-gray-700",children:["第 ",p.page," 页，共 ",p.totalPages," 页"]}),e("button",{onClick:()=>$(p.page+1),disabled:!p.hasNext,className:"flex items-center gap-1 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["下一页",a(h,{className:"w-4 h-4"})]})]})]})]})},D=({record:t,isOpen:s,onClose:l,onUpdate:n,onDelete:d})=>{const[m,h]=r.useState(!1),[w,S]=r.useState({userNotes:t.userNotes||"",symptoms:t.symptoms||[],isShared:t.isShared}),[C,k]=r.useState("");if(!s)return null;const j=()=>{C.trim()&&!w.symptoms.includes(C.trim())&&(S(e=>({...e,symptoms:[...e.symptoms,C.trim()]})),k(""))},R=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});return a("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e("div",{className:"flex items-center gap-4",children:[a("h2",{className:"text-xl font-semibold text-gray-900",children:"记录详情"}),e("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full border ${(e=>{switch(e){case"healthy":return"bg-green-100 text-green-800 border-green-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"concerning":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(t.analysis.healthStatus)}`,children:[(e=>{switch(e){case"healthy":return a(x,{className:"w-6 h-6 text-green-500"});case"warning":return a(u,{className:"w-6 h-6 text-yellow-500"});case"concerning":return a(g,{className:"w-6 h-6 text-red-500"});default:return a(g,{className:"w-6 h-6 text-gray-400"})}})(t.analysis.healthStatus),a("span",{className:"text-sm font-medium",children:t.analysis.healthStatusDescription})]})]}),e("div",{className:"flex items-center gap-2",children:[!m&&e("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-3 py-2 text-blue-600 hover:text-blue-800 border border-blue-300 rounded-lg hover:bg-blue-50",children:[a(i,{className:"w-4 h-4"}),"编辑"]}),a("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:a(p,{className:"w-6 h-6"})})]})]}),a("div",{className:"p-6",children:e("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e("div",{children:[e("div",{className:"mb-6",children:[a("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"宠物信息"}),e("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[t.pet.avatar?a("img",{src:t.pet.avatar,alt:t.pet.name,className:"w-16 h-16 rounded-full object-cover"}):a("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center",children:a("span",{className:"text-xl text-gray-500",children:t.pet.name.charAt(0)})}),e("div",{children:[a("h4",{className:"text-lg font-medium text-gray-900",children:t.pet.name}),a("p",{className:"text-gray-600",children:t.pet.breed||t.pet.type})]})]})]}),e("div",{className:"mb-6",children:[a("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"分析图片"}),e("div",{className:"relative",children:[a("img",{src:t.imageUrl,alt:"分析图片",className:"w-full rounded-lg shadow-sm"}),a("button",{onClick:()=>window.open(t.imageUrl,"_blank"),className:"absolute top-2 right-2 p-2 bg-white bg-opacity-80 rounded-lg hover:bg-opacity-100",title:"下载图片",children:a(y,{className:"w-4 h-4"})})]})]}),e("div",{className:"space-y-3",children:[e("div",{className:"flex items-center gap-2 text-gray-600",children:[a(c,{className:"w-4 h-4"}),e("span",{children:["记录时间：",R(t.timestamp)]})]}),t.location&&e("div",{className:"flex items-center gap-2 text-gray-600",children:[a(N,{className:"w-4 h-4"}),e("span",{children:["位置：",t.location.latitude.toFixed(6),", ",t.location.longitude.toFixed(6)]})]}),t.weather&&e("div",{className:"flex items-center gap-4 text-gray-600",children:[e("div",{className:"flex items-center gap-2",children:[a(b,{className:"w-4 h-4"}),e("span",{children:[t.weather.temperature,"°C"]})]}),e("div",{className:"flex items-center gap-2",children:[a(v,{className:"w-4 h-4"}),e("span",{children:[t.weather.humidity,"%"]})]})]})]})]}),e("div",{children:[e("div",{className:"mb-6",children:[a("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"分析结果"}),e("div",{className:"space-y-4",children:[e("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e("div",{children:[a("span",{className:"text-sm text-gray-600",children:"形状类型"}),a("p",{className:"font-medium",children:t.analysis.shapeDescription})]}),e("div",{children:[a("span",{className:"text-sm text-gray-600",children:"置信度"}),e("p",{className:"font-medium",children:[t.analysis.confidence,"%"]})]})]}),e("div",{className:"mb-4",children:[a("span",{className:"text-sm text-gray-600",children:"详细分析"}),a("p",{className:"mt-1 text-gray-900",children:t.analysis.details})]}),t.analysis.detectedFeatures&&e("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e("div",{children:[a("span",{className:"text-gray-600",children:"颜色："}),a("span",{className:"font-medium",children:t.analysis.detectedFeatures.color})]}),e("div",{children:[a("span",{className:"text-gray-600",children:"质地："}),a("span",{className:"font-medium",children:t.analysis.detectedFeatures.texture})]}),e("div",{children:[a("span",{className:"text-gray-600",children:"稠度："}),a("span",{className:"font-medium",children:t.analysis.detectedFeatures.consistency})]}),e("div",{children:[a("span",{className:"text-gray-600",children:"大小："}),a("span",{className:"font-medium",children:t.analysis.detectedFeatures.size})]})]})]}),t.analysis.recommendations&&t.analysis.recommendations.length>0&&e("div",{children:[a("span",{className:"text-sm text-gray-600",children:"健康建议"}),a("ul",{className:"mt-2 space-y-1",children:t.analysis.recommendations.map((t,r)=>e("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a("span",{className:"text-orange-500 mt-1",children:"•"}),t]},r))})]})]})]}),e("div",{className:"mb-6",children:[a("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"用户备注"}),m?a("textarea",{value:w.userNotes,onChange:e=>S(a=>({...a,userNotes:e.target.value})),placeholder:"添加备注...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"}):a("div",{className:"p-4 bg-gray-50 rounded-lg",children:a("p",{className:"text-gray-700",children:t.userNotes||"暂无备注"})})]}),e("div",{className:"mb-6",children:[a("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"相关症状"}),m?e("div",{children:[e("div",{className:"flex gap-2 mb-3",children:[a("input",{type:"text",value:C,onChange:e=>k(e.target.value),placeholder:"添加症状",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",onKeyPress:e=>"Enter"===e.key&&j()}),a("button",{onClick:j,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:"添加"})]}),a("div",{className:"flex flex-wrap gap-2",children:w.symptoms.map((t,r)=>e("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[t,a("button",{onClick:()=>(e=>{S(a=>({...a,symptoms:a.symptoms.filter(a=>a!==e)}))})(t),className:"text-blue-600 hover:text-blue-800",children:a(p,{className:"w-3 h-3"})})]},r))})]}):a("div",{className:"flex flex-wrap gap-2",children:t.symptoms&&t.symptoms.length>0?t.symptoms.map((e,t)=>a("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:e},t)):a("p",{className:"text-gray-500",children:"暂无症状记录"})})]}),a("div",{className:"mb-6",children:e("div",{className:"flex items-center justify-between",children:[a("h3",{className:"text-lg font-medium text-gray-900",children:"分享设置"}),m?e("label",{className:"flex items-center gap-2",children:[a("input",{type:"checkbox",checked:w.isShared,onChange:e=>S(a=>({...a,isShared:e.target.checked})),className:"rounded border-gray-300 text-orange-600 focus:ring-orange-500"}),a("span",{className:"text-sm text-gray-700",children:"分享到社区"})]}):e("div",{className:"flex items-center gap-2",children:[a(o,{className:"w-4 h-4 "+(t.isShared?"text-green-500":"text-gray-400")}),a("span",{className:"text-sm text-gray-700",children:t.isShared?"已分享到社区":"未分享"})]})]})}),m&&e("div",{className:"flex gap-3",children:[e("button",{onClick:()=>{n&&n(w),h(!1)},className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",children:[a(f,{className:"w-4 h-4"}),"保存"]}),a("button",{onClick:()=>{S({userNotes:t.userNotes||"",symptoms:t.symptoms||[],isShared:t.isShared}),h(!1)},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"取消"})]})]})]})}),!m&&e("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-between",children:[e("div",{className:"text-sm text-gray-500",children:["创建时间：",R(t.createdAt),t.updatedAt!==t.createdAt&&e("span",{className:"ml-4",children:["更新时间：",R(t.updatedAt)]})]}),d&&a("button",{onClick:d,className:"text-red-600 hover:text-red-800 text-sm",children:"删除记录"})]})]})})},P=({statistics:t,petSummaries:r,loading:s,onPeriodChange:l,selectedPeriod:n})=>s?a("div",{className:"bg-white rounded-lg shadow p-6",children:e("div",{className:"animate-pulse",children:[a("div",{className:"h-6 bg-gray-200 rounded w-1/4 mb-4"}),a("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[...Array(4)].map((e,t)=>a("div",{className:"h-24 bg-gray-200 rounded"},t))}),a("div",{className:"h-64 bg-gray-200 rounded"})]})}):e("div",{className:"space-y-6",children:[e("div",{className:"bg-white rounded-lg shadow",children:[a("div",{className:"p-6 border-b border-gray-200",children:e("div",{className:"flex items-center justify-between",children:[e("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[a(w,{className:"w-5 h-5"}),"健康统计概览"]}),a("div",{className:"flex items-center gap-2",children:[{value:"week",label:"本周"},{value:"month",label:"本月"},{value:"quarter",label:"本季度"},{value:"year",label:"本年"}].map(e=>a("button",{onClick:()=>l(e.value),className:"px-3 py-1 text-sm rounded-lg transition-colors "+(n===e.value?"bg-orange-500 text-white":"text-gray-600 hover:bg-gray-100"),children:e.label},e.value))})]})}),t&&e("div",{className:"p-6",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e("div",{className:"bg-blue-50 rounded-lg p-4",children:[e("div",{className:"flex items-center justify-between",children:[e("div",{children:[a("p",{className:"text-sm text-blue-600 font-medium",children:"总记录数"}),a("p",{className:"text-2xl font-bold text-blue-900",children:t.totalRecords})]}),a(c,{className:"w-8 h-8 text-blue-500"})]}),e("p",{className:"text-xs text-blue-600 mt-2",children:["平均每周 ",t.averagePerWeek," 条"]})]}),e("div",{className:"bg-green-50 rounded-lg p-4",children:[e("div",{className:"flex items-center justify-between",children:[e("div",{children:[a("p",{className:"text-sm text-green-600 font-medium",children:"健康记录"}),a("p",{className:"text-2xl font-bold text-green-900",children:t.healthyCount})]}),a(x,{className:"w-8 h-8 text-green-500"})]}),e("p",{className:"text-xs text-green-600 mt-2",children:["占比 ",t.healthyPercentage,"%"]})]}),e("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e("div",{className:"flex items-center justify-between",children:[e("div",{children:[a("p",{className:"text-sm text-yellow-600 font-medium",children:"警告记录"}),a("p",{className:"text-2xl font-bold text-yellow-900",children:t.warningCount})]}),a(u,{className:"w-8 h-8 text-yellow-500"})]}),e("p",{className:"text-xs text-yellow-600 mt-2",children:["占比 ",t.warningPercentage,"%"]})]}),e("div",{className:"bg-red-50 rounded-lg p-4",children:[e("div",{className:"flex items-center justify-between",children:[e("div",{children:[a("p",{className:"text-sm text-red-600 font-medium",children:"异常记录"}),a("p",{className:"text-2xl font-bold text-red-900",children:t.concerningCount})]}),a(g,{className:"w-8 h-8 text-red-500"})]}),e("p",{className:"text-xs text-red-600 mt-2",children:["占比 ",t.concerningPercentage,"%"]})]})]}),e("div",{className:"bg-gray-50 rounded-lg p-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[a(S,{className:"w-5 h-5"}),"健康状态分布"]}),a("div",{className:"flex items-center justify-center",children:a("div",{className:"relative w-48 h-48",children:e("div",{className:"space-y-3",children:[e("div",{className:"flex items-center justify-between",children:[a("span",{className:"text-sm text-gray-600",children:"健康"}),e("span",{className:"text-sm font-medium text-green-600",children:[t.healthyPercentage,"%"]})]}),a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${t.healthyPercentage}%`}})}),e("div",{className:"flex items-center justify-between",children:[a("span",{className:"text-sm text-gray-600",children:"警告"}),e("span",{className:"text-sm font-medium text-yellow-600",children:[t.warningPercentage,"%"]})]}),a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${t.warningPercentage}%`}})}),e("div",{className:"flex items-center justify-between",children:[a("span",{className:"text-sm text-gray-600",children:"异常"}),e("span",{className:"text-sm font-medium text-red-600",children:[t.concerningPercentage,"%"]})]}),a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${t.concerningPercentage}%`}})})]})})}),e("div",{className:"mt-4 text-center",children:[e("p",{className:"text-sm text-gray-600",children:["平均置信度：",e("span",{className:"font-medium",children:[t.avgConfidence,"%"]})]}),e("p",{className:"text-sm text-gray-600",children:["监测宠物数：",a("span",{className:"font-medium",children:t.uniquePetsCount})]})]})]})]})]}),r.length>0&&e("div",{className:"bg-white rounded-lg shadow",children:[a("div",{className:"p-6 border-b border-gray-200",children:e("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[a(C,{className:"w-5 h-5"}),"宠物健康汇总"]})}),a("div",{className:"p-6",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(t=>{return e("div",{className:"border border-gray-200 rounded-lg p-4",children:[e("div",{className:"flex items-center justify-between mb-3",children:[a("h3",{className:"font-medium text-gray-900",children:t.petName}),a("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.petType})]}),e("div",{className:"space-y-2 mb-4",children:[e("div",{className:"flex justify-between text-sm",children:[a("span",{className:"text-gray-600",children:"总记录"}),a("span",{className:"font-medium",children:t.totalRecords})]}),e("div",{className:"flex justify-between text-sm",children:[a("span",{className:"text-gray-600",children:"健康率"}),e("span",{className:"font-medium text-green-600",children:[t.healthyPercentage,"%"]})]}),e("div",{className:"flex justify-between text-sm",children:[a("span",{className:"text-gray-600",children:"平均置信度"}),e("span",{className:"font-medium",children:[t.avgConfidence,"%"]})]})]}),e("div",{className:"space-y-2",children:[e("div",{className:"flex items-center justify-between text-xs",children:[e("span",{className:"text-green-600",children:["健康 ",t.healthyCount]}),e("span",{className:"text-yellow-600",children:["警告 ",t.warningCount]}),e("span",{className:"text-red-600",children:["异常 ",t.concerningCount]})]}),a("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e("div",{className:"flex h-2 rounded-full overflow-hidden",children:[a("div",{className:"bg-green-500",style:{width:`${t.healthyPercentage}%`}}),a("div",{className:"bg-yellow-500",style:{width:t.warningCount/t.totalRecords*100+"%"}}),a("div",{className:"bg-red-500",style:{width:t.concerningCount/t.totalRecords*100+"%"}})]})})]}),e("div",{className:"mt-3 text-xs text-gray-500",children:["最近记录：",(r=t.lastRecord,new Date(r).toLocaleDateString("zh-CN"))]})]},t.petId);var r})})})]}),!t&&!s&&e("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[a(w,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无统计数据"}),a("p",{className:"text-gray-600",children:"开始记录宠物健康数据后，这里将显示详细的统计信息"})]})]});const $=new class{async getRecords(e={}){const a=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&(Array.isArray(t)?t.forEach(t=>a.append(e,t.toString())):a.append(e,t.toString()))});return(await j.get(`/records?${a.toString()}`)).data.data}async getRecordById(e){return(await j.get(`/records/${e}`)).data.data}async updateRecord(e,a){return(await j.put(`/records/${e}`,a)).data.data}async deleteRecord(e){await j.delete(`/records/${e}`)}async getStatisticsOverview(e="month"){return(await j.get(`/records/statistics/overview?period=${e}`)).data.data}async getPetStatistics(e,a="month"){return(await j.get(`/records/statistics/pet/${e}?period=${a}`)).data.data}async getHealthTrends(e,a="month"){return(await j.get(`/records/trends/health/${e}?period=${a}`)).data.data}async getAggregationSummary(){return(await j.get("/records/aggregation/summary")).data.data}async batchDeleteRecords(e){return(await j.post("/records/batch/delete",{recordIds:e})).data.data}async batchUpdateRecords(e,a){return(await j.post("/records/batch/update",{recordIds:e,updateData:a})).data.data}},A=()=>{t();const[s,l]=r.useState("list"),[n,d]=r.useState(null),[i,o]=r.useState(!1),[m,h]=r.useState("month"),{records:g,pagination:u,filters:x,loading:p,error:y,updateFilters:N,resetFilters:b,deleteRecord:v,updateRecord:f,batchDeleteRecords:S,setError:C}=((e={})=>{const[a,t]=r.useState([]),[s,l]=r.useState(null),[n,c]=r.useState(e),[d,i]=r.useState(!1),[o,m]=r.useState(null),h=r.useCallback(async e=>{var a,r;try{i(!0),m(null);const a=e||n,r=await $.getRecords(a);t(r.records),l(r.pagination)}catch(s){m((null==(r=null==(a=s.response)?void 0:a.data)?void 0:r.message)||"获取记录失败")}finally{i(!1)}},[n]),g=r.useCallback(e=>{const a={...n,...e};c(a),h(a)},[n,h]),u=r.useCallback(()=>{const e={page:1,limit:10};c(e),h(e)},[h]),x=r.useCallback(async e=>{var a,t;try{return await $.deleteRecord(e),h(),!0}catch(r){return m((null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.message)||"删除记录失败"),!1}},[h]),p=r.useCallback(async(e,a)=>{var r,s;try{const r=await $.updateRecord(e,a);return t(a=>a.map(a=>a.id===e?r:a)),r}catch(l){return m((null==(s=null==(r=l.response)?void 0:r.data)?void 0:s.message)||"更新记录失败"),null}},[]),y=r.useCallback(async e=>{var a,t;try{const a=await $.batchDeleteRecords(e);return h(),a}catch(r){return m((null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.message)||"批量删除失败"),null}},[h]);return r.useEffect(()=>{h()},[]),{records:a,pagination:s,filters:n,loading:d,error:o,fetchRecords:h,updateFilters:g,resetFilters:u,deleteRecord:x,updateRecord:p,batchDeleteRecords:y,setError:m}})(),{statistics:j,aggregationSummary:A,loading:F,error:E,fetchStatistics:z,fetchAggregationSummary:U,setError:O}=(()=>{const[e,a]=r.useState(null),[t,s]=r.useState({}),[l,n]=r.useState(null),[c,d]=r.useState(!1),[i,o]=r.useState(null);return{statistics:e,petStatistics:t,aggregationSummary:l,loading:c,error:i,fetchStatistics:r.useCallback(async(e="month")=>{var t,r;try{d(!0),o(null);const t=await $.getStatisticsOverview(e);a(t)}catch(s){o((null==(r=null==(t=s.response)?void 0:t.data)?void 0:r.message)||"获取统计数据失败")}finally{d(!1)}},[]),fetchPetStatistics:r.useCallback(async(e,a="month")=>{var t,r;try{const t=await $.getPetStatistics(e,a);return s(a=>({...a,[e]:t})),t}catch(l){return o((null==(r=null==(t=l.response)?void 0:t.data)?void 0:r.message)||"获取宠物统计失败"),null}},[]),fetchAggregationSummary:r.useCallback(async()=>{var e,a;try{d(!0),o(null);const e=await $.getAggregationSummary();n(e)}catch(t){o((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"获取汇总数据失败")}finally{d(!1)}},[]),setError:o}})();r.useEffect(()=>{"stats"===s&&(z(m),U())},[s,m,z,U]);return a("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a("div",{className:"mb-8",children:e("div",{className:"flex items-center justify-between",children:[e("div",{children:[a("h1",{className:"text-3xl font-bold text-gray-900",children:"健康记录"}),a("p",{className:"mt-2 text-gray-600",children:"查看和管理宠物的健康分析记录"})]}),e("button",{onClick:()=>window.location.href="/analysis",className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:[a(k,{className:"w-4 h-4"}),"新增记录"]})]})}),(y||E)&&e("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a("p",{className:"text-red-600",children:y||E}),a("button",{onClick:()=>{C(null),O(null)},className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"关闭"})]}),a("div",{className:"mb-6",children:a("div",{className:"border-b border-gray-200",children:e("nav",{className:"-mb-px flex space-x-8",children:[e("button",{onClick:()=>l("list"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("list"===s?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a(c,{className:"w-4 h-4 inline mr-2"}),"记录列表"]}),e("button",{onClick:()=>l("stats"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("stats"===s?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a(w,{className:"w-4 h-4 inline mr-2"}),"统计分析"]})]})})}),"list"===s?a(R,{records:g,pagination:u,filters:x,loading:p,onFiltersChange:N,onViewRecord:e=>{d(e),o(!0)},onEditRecord:e=>{d(e),o(!0)},onDeleteRecord:async e=>{window.confirm("确定要删除这条记录吗？此操作不可撤销。")&&await v(e.id)},onBatchDelete:async e=>{window.confirm(`确定要删除选中的 ${e.length} 条记录吗？此操作不可撤销。`)&&await S(e)}}):a(P,{statistics:j,petSummaries:(null==A?void 0:A.petSummaries)||[],loading:F,onPeriodChange:e=>{h(e),z(e)},selectedPeriod:m}),n&&a(D,{record:n,isOpen:i,onClose:()=>{o(!1),d(null)},onUpdate:async e=>{if(n){const a=await f(n.id,e);a&&d(a)}},onDelete:async()=>{if(n){await v(n.id)&&(o(!1),d(null))}}})]})})};export{A as default};
