import{j as e,a as t}from"./index-379b094b.js";import{r}from"./react-vendor-7927b0b6.js";import{u as a}from"./usePets-2d4c1e5f.js";import{z as l,q as s,a as i,a1 as n,a2 as d,X as c,N as o,a3 as m,y as g,A as h}from"./ui-vendor-f43192ea.js";import"./router-2b5ad94b.js";import"./utils-2ce30174.js";import"./api-f70ec57c.js";const u=({pet:r,onEdit:a,onDelete:c})=>e("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 p-6",children:[e("div",{className:"flex items-start justify-between mb-4",children:[e("div",{className:"flex items-center space-x-3",children:[t("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center",children:r.avatar?t("img",{src:r.avatar,alt:r.name,className:"w-16 h-16 rounded-full object-cover"}):(e=>{switch(e){case"dog":return t(d,{className:"w-6 h-6 text-orange-500"});case"cat":return t(n,{className:"w-6 h-6 text-orange-500"});default:return t(i,{className:"w-6 h-6 text-orange-500"})}})(r.type)}),e("div",{children:[t("h3",{className:"text-lg font-semibold text-gray-900",children:r.name}),e("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[t("span",{children:(e=>{switch(e){case"dog":return"狗狗";case"cat":return"猫咪";default:return"其他"}})(r.type)}),r.breed&&e("span",{children:["• ",r.breed]}),r.gender&&e("span",{children:["• ",(e=>{switch(e){case"male":return"♂ 公";case"female":return"♀ 母";default:return""}})(r.gender)]})]})]})]}),e("div",{className:"flex space-x-2",children:[t("button",{onClick:()=>a(r),className:"p-2 text-gray-400 hover:text-orange-500 hover:bg-orange-50 rounded-lg transition-colors",title:"编辑宠物信息",children:t(l,{className:"w-4 h-4"})}),t("button",{onClick:()=>c(r),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"删除宠物",children:t(s,{className:"w-4 h-4"})})]})]}),e("div",{className:"space-y-2",children:[r.age&&e("div",{className:"flex justify-between text-sm",children:[t("span",{className:"text-gray-600",children:"年龄:"}),t("span",{className:"text-gray-900",children:(e=>{if(!e)return"";if(e<12)return`${e}个月`;{const t=Math.floor(e/12),r=e%12;return r>0?`${t}岁${r}个月`:`${t}岁`}})(r.age)})]}),r.weight&&e("div",{className:"flex justify-between text-sm",children:[t("span",{className:"text-gray-600",children:"体重:"}),e("span",{className:"text-gray-900",children:[r.weight,"kg"]})]}),r.description&&e("div",{className:"text-sm",children:[t("span",{className:"text-gray-600",children:"描述:"}),t("p",{className:"text-gray-900 mt-1 line-clamp-2",children:r.description})]})]}),r.medicalHistory&&t("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e("div",{className:"text-xs text-gray-500",children:[r.medicalHistory.allergies.length>0&&e("div",{className:"mb-1",children:[t("span",{className:"font-medium",children:"过敏:"})," ",r.medicalHistory.allergies.join(", ")]}),r.medicalHistory.conditions.length>0&&e("div",{children:[t("span",{className:"font-medium",children:"病史:"})," ",r.medicalHistory.conditions.join(", ")]})]})}),e("div",{className:"mt-4 text-xs text-gray-400",children:["添加于 ",new Date(r.createdAt).toLocaleDateString("zh-CN")]})]}),x=({pet:a,isOpen:l,onClose:s,onSubmit:i,loading:n})=>{var d,g,h;const[u,x]=r.useState({name:"",type:"dog",breed:"",gender:void 0,age:void 0,weight:void 0,description:"",medicalHistory:{allergies:[],medications:[],conditions:[]}}),[p,b]=r.useState({});r.useEffect(()=>{x(a?{name:a.name,type:a.type,breed:a.breed||"",gender:a.gender,age:a.age,weight:a.weight,description:a.description||"",medicalHistory:a.medicalHistory||{allergies:[],medications:[],conditions:[]}}:{name:"",type:"dog",breed:"",gender:void 0,age:void 0,weight:void 0,description:"",medicalHistory:{allergies:[],medications:[],conditions:[]}}),b({})},[a,l]);const y=(e,t)=>{x(r=>({...r,[e]:t})),p[e]&&b(t=>({...t,[e]:""}))},f=(e,t,r)=>{x(a=>({...a,medicalHistory:{...a.medicalHistory,[e]:a.medicalHistory[e].map((e,a)=>a===t?r:e)}}))},v=e=>{x(t=>({...t,medicalHistory:{...t.medicalHistory,[e]:[...t.medicalHistory[e],""]}}))},N=(e,t)=>{x(r=>({...r,medicalHistory:{...r.medicalHistory,[e]:r.medicalHistory[e].filter((e,r)=>r!==t)}}))};return l?t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t("h2",{className:"text-xl font-semibold text-gray-900",children:a?"编辑宠物信息":"添加新宠物"}),t("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg",children:t(c,{className:"w-5 h-5"})})]}),e("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return u.name.trim()?u.name.length>20&&(e.name="宠物名称不能超过20个字符"):e.name="宠物名称是必填项",u.type||(e.type="宠物类型是必填项"),u.breed&&u.breed.length>50&&(e.breed="品种名称不能超过50个字符"),void 0!==u.age&&(u.age<0||u.age>360)&&(e.age="年龄必须在0-360个月之间"),void 0!==u.weight&&(u.weight<0||u.weight>200)&&(e.weight="体重必须在0-200kg之间"),u.description&&u.description.length>500&&(e.description="描述不能超过500个字符"),b(e),0===Object.keys(e).length})())return;await i(u)&&s()},className:"p-6 space-y-6",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["宠物名称 ",t("span",{className:"text-red-500",children:"*"})]}),t("input",{type:"text",value:u.name,onChange:e=>y("name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 "+(p.name?"border-red-500":"border-gray-300"),placeholder:"请输入宠物名称"}),p.name&&t("p",{className:"mt-1 text-sm text-red-500",children:p.name})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["宠物类型 ",t("span",{className:"text-red-500",children:"*"})]}),e("select",{value:u.type,onChange:e=>y("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[t("option",{value:"dog",children:"狗狗"}),t("option",{value:"cat",children:"猫咪"}),t("option",{value:"other",children:"其他"})]})]}),e("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"品种"}),t("input",{type:"text",value:u.breed,onChange:e=>y("breed",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 "+(p.breed?"border-red-500":"border-gray-300"),placeholder:"请输入品种"}),p.breed&&t("p",{className:"mt-1 text-sm text-red-500",children:p.breed})]}),e("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性别"}),e("select",{value:u.gender||"",onChange:e=>y("gender",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[t("option",{value:"",children:"请选择性别"}),t("option",{value:"male",children:"公"}),t("option",{value:"female",children:"母"})]})]}),e("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"年龄（月）"}),t("input",{type:"number",value:u.age||"",onChange:e=>y("age",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 "+(p.age?"border-red-500":"border-gray-300"),placeholder:"请输入年龄",min:"0",max:"360"}),p.age&&t("p",{className:"mt-1 text-sm text-red-500",children:p.age})]}),e("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"体重（kg）"}),t("input",{type:"number",step:"0.1",value:u.weight||"",onChange:e=>y("weight",e.target.value?parseFloat(e.target.value):void 0),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 "+(p.weight?"border-red-500":"border-gray-300"),placeholder:"请输入体重",min:"0",max:"200"}),p.weight&&t("p",{className:"mt-1 text-sm text-red-500",children:p.weight})]})]}),e("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"描述"}),t("textarea",{value:u.description,onChange:e=>y("description",e.target.value),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 "+(p.description?"border-red-500":"border-gray-300"),placeholder:"请输入宠物描述"}),p.description&&t("p",{className:"mt-1 text-sm text-red-500",children:p.description})]}),e("div",{className:"space-y-4",children:[t("h3",{className:"text-lg font-medium text-gray-900",children:"医疗历史"}),e("div",{children:[e("div",{className:"flex items-center justify-between mb-2",children:[t("label",{className:"block text-sm font-medium text-gray-700",children:"过敏史"}),e("button",{type:"button",onClick:()=>v("allergies"),className:"flex items-center text-sm text-orange-600 hover:text-orange-700",children:[t(o,{className:"w-4 h-4 mr-1"}),"添加"]})]}),null==(d=u.medicalHistory)?void 0:d.allergies.map((r,a)=>e("div",{className:"flex items-center space-x-2 mb-2",children:[t("input",{type:"text",value:r,onChange:e=>f("allergies",a,e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"请输入过敏源"}),t("button",{type:"button",onClick:()=>N("allergies",a),className:"p-2 text-red-500 hover:text-red-700",children:t(m,{className:"w-4 h-4"})})]},a))]}),e("div",{children:[e("div",{className:"flex items-center justify-between mb-2",children:[t("label",{className:"block text-sm font-medium text-gray-700",children:"用药史"}),e("button",{type:"button",onClick:()=>v("medications"),className:"flex items-center text-sm text-orange-600 hover:text-orange-700",children:[t(o,{className:"w-4 h-4 mr-1"}),"添加"]})]}),null==(g=u.medicalHistory)?void 0:g.medications.map((r,a)=>e("div",{className:"flex items-center space-x-2 mb-2",children:[t("input",{type:"text",value:r,onChange:e=>f("medications",a,e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"请输入药物名称"}),t("button",{type:"button",onClick:()=>N("medications",a),className:"p-2 text-red-500 hover:text-red-700",children:t(m,{className:"w-4 h-4"})})]},a))]}),e("div",{children:[e("div",{className:"flex items-center justify-between mb-2",children:[t("label",{className:"block text-sm font-medium text-gray-700",children:"疾病史"}),e("button",{type:"button",onClick:()=>v("conditions"),className:"flex items-center text-sm text-orange-600 hover:text-orange-700",children:[t(o,{className:"w-4 h-4 mr-1"}),"添加"]})]}),null==(h=u.medicalHistory)?void 0:h.conditions.map((r,a)=>e("div",{className:"flex items-center space-x-2 mb-2",children:[t("input",{type:"text",value:r,onChange:e=>f("conditions",a,e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"请输入疾病名称"}),t("button",{type:"button",onClick:()=>N("conditions",a),className:"p-2 text-red-500 hover:text-red-700",children:t(m,{className:"w-4 h-4"})})]},a))]})]}),e("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[t("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:n,children:"取消"}),t("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white hover:bg-orange-600 rounded-lg transition-colors disabled:opacity-50",disabled:n,children:n?"保存中...":a?"更新":"添加"})]})]})]})}):null},p=()=>{const{pets:l,loading:s,error:i,createPet:n,updatePet:d,deletePet:c,clearError:m}=a(),[p,b]=r.useState(!1),[y,f]=r.useState(null),[v,N]=r.useState(""),[w,C]=r.useState(null),k=l.filter(e=>e.name.toLowerCase().includes(v.toLowerCase())||e.breed&&e.breed.toLowerCase().includes(v.toLowerCase())),j=()=>{f(null),b(!0)},H=e=>{f(e),b(!0)},S=e=>{C(e)};return t("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[t("div",{className:"mb-8",children:e("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e("div",{children:[t("h1",{className:"text-3xl font-bold text-gray-900",children:"我的宠物"}),t("p",{className:"mt-2 text-gray-600",children:"管理您的宠物信息，记录它们的健康状况"})]}),t("div",{className:"mt-4 sm:mt-0",children:e("button",{onClick:j,className:"inline-flex items-center px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[t(o,{className:"w-5 h-5 mr-2"}),"添加宠物"]})})]})}),t("div",{className:"mb-6",children:e("div",{className:"relative max-w-md",children:[t(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),t("input",{type:"text",placeholder:"搜索宠物名称或品种...",value:v,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})}),i&&t("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e("div",{className:"flex items-center",children:[t(h,{className:"w-5 h-5 text-red-500 mr-2"}),t("span",{className:"text-red-700",children:i}),t("button",{onClick:m,className:"ml-auto text-red-500 hover:text-red-700",children:"×"})]})}),s?e("div",{className:"flex justify-center items-center py-12",children:[t("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),t("span",{className:"ml-2 text-gray-600",children:"加载中..."})]}):0===k.length?e("div",{className:"text-center py-12",children:[t("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:t(o,{className:"w-12 h-12 text-gray-400"})}),t("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:v?"没有找到匹配的宠物":"还没有添加宠物"}),t("p",{className:"text-gray-600 mb-4",children:v?"尝试使用其他关键词搜索":"添加您的第一只宠物，开始记录它们的健康状况"}),!v&&e("button",{onClick:j,className:"inline-flex items-center px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[t(o,{className:"w-5 h-5 mr-2"}),"添加宠物"]})]}):t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(e=>t(u,{pet:e,onEdit:H,onDelete:S},e.id))}),t(x,{pet:y,isOpen:p,onClose:()=>{b(!1),f(null)},onSubmit:async e=>y?await d(y.id,e):await n(e),loading:s}),w&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e("div",{className:"flex items-center mb-4",children:[t(h,{className:"w-6 h-6 text-red-500 mr-3"}),t("h3",{className:"text-lg font-semibold text-gray-900",children:"确认删除"})]}),e("p",{className:"text-gray-600 mb-6",children:["您确定要删除宠物 ",t("strong",{children:w.name})," 吗？此操作无法撤销。"]}),e("div",{className:"flex justify-end space-x-3",children:[t("button",{onClick:()=>C(null),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"取消"}),t("button",{onClick:async()=>{w&&(await c(w.id),C(null))},className:"px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-colors",disabled:s,children:s?"删除中...":"确认删除"})]})]})})]})})};export{p as default};
